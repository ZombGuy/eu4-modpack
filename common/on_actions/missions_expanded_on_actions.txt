# Missions Expanded on actions
# Remember to keep the vanilla effects

on_bi_yearly_pulse_3 = {
	#Fire estate agenda if you have that privilege
	# NOTE DOING THIS THROUGH RANDOM EVENT NOW WITH estate_privileges_and_agendas_events.4 INSTEAD!
	#on_bi_yearly_pulse_estate_privileges_effect = yes
	events = {
		muslim_school_events.20 #Pick School
		# GE:
		GE_script_events.1
		GE_script_events.2
		GE_script_events.3
		GE_script_events.4
		GE_script_events.5
		GE_script_events.6
	}
	random_events = {
		100 = new_court_flavour_events.25 #blood is thicker than water
		200 = 0
	}
	# GE:
	ge_on_bi_yearly_pulse_3_effect = yes
}

on_five_year_pulse_4 = {
	if = { #fail-safe for flavor_pap.7, making religious leagues happen at some point if there is no PAP
		limit = {
			is_year = 1610
			NOT = { exists = PAP }
			NOT = { has_global_flag = counter_reformation }
		}
		set_global_flag = counter_reformation
	}
	#fail-safe if for whatever reason these flags stay after being used in events
	if = {
		limit = {
			had_country_flag = {
				flag = advisor_events_adm
				days = 720
			}
		}
		clr_country_flag = advisor_events_adm
	}
	if = {
		limit = {
			had_country_flag = {
				flag = advisor_events_dip
				days = 720
			}
		}
		clr_country_flag = advisor_events_dip
	}
	if = {
		limit = {
			had_country_flag = {
				flag = advisor_events_mil
				days = 720
			}
		}
		clr_country_flag = advisor_events_mil
	}
	#Clearing of Jewish events flags
	if = {
		limit = {
			had_country_flag = {
				flag = shalosh_regalim
				days = 365
			}
		}
		clr_country_flag = shalosh_regalim
	}
	random_events = {
		200 = 0
		100 = kalmar_union_events.7
		100 = kalmar_union_events.8
		100 = kalmar_union_events.9
	}

	# GE:
	random_events = {
		2000 = 0
		200 = peasants_estate_events.1 #Swedish Peasant Estate
		300 = peasants_estate_events.2
		200 = peasants_estate_events.3
		100 = peasants_estate_events.4
		100 = peasants_estate_events.5
		100 = peasants_estate_events.6
	}
	random_events = {
		1000 = 0
		#Monarchy
		#T2
		100 = GE_reform_cycle.1 #metropolian_bishop_reform
		100 = GE_reform_cycle.2
		100 = GE_reform_cycle.3 #papal_embassy_reform
		100 = GE_reform_cycle.4
		101 = GE_reform_cycle_monarchy.241
		100 = GE_reform_cycle.5 #diplomatic_positions
		100 = GE_reform_cycle.6
		101 = GE_reform_cycle_monarchy.221
		100 = GE_reform_cycle.7 #promote_nobles
		100 = GE_reform_cycle.8
		100 = GE_reform_cycle_monarchy.201 #NEW #Promote Nobles
		100 = GE_reform_cycle_monarchy.202
		101 = GE_reform_cycle_monarchy.203
		100 = GE_reform_cycle.9 #curtail_nobles
		100 = GE_reform_cycle.10
		101 = GE_reform_cycle_monarchy.211
		100 = GE_reform_cycle.11 #guild_dominance
		100 = GE_reform_cycle.12
		100 = GE_reform_cycle.13 #trade_princes
		100 = GE_reform_cycle.14
		101 = GE_reform_cycle_monarchy.231
		100 = GE_reform_cycle.15 #state_church
		100 = GE_reform_cycle.16
		100 = GE_reform_cycle.17 #dhimmi_nobles
		100 = GE_reform_cycle.18
		100 = GE_reform_cycle.19 #muscovite_manorialism
		100 = GE_reform_cycle.20
		100 = GE_reform_cycle.21 #order_of_the_swan
		100 = GE_reform_cycle.22
		#T3
		100 = GE_reform_cycle.23 #centralized
		100 = GE_reform_cycle.24
		101 = GE_reform_cycle_monarchy.321
		100 = GE_reform_cycle.25 #decentralized
		100 = GE_reform_cycle.26
		101 = GE_reform_cycle_monarchy.331
		100 = GE_reform_cycle.27 #regional_fort
		100 = GE_reform_cycle.28
		101 = GE_reform_cycle_monarchy.311
		100 = GE_reform_cycle.29 #theocrat
		100 = GE_reform_cycle.30
		101 = GE_reform_cycle_monarchy.303
		100 = GE_reform_cycle.31 #casa_de_india
		100 = GE_reform_cycle.32
		101 = GE_reform_cycle_monarchy.351
		101 = GE_reform_cycle_monarchy.341 #trader_division
		101 = GE_reform_cycle_monarchy.342
		101 = GE_reform_cycle_monarchy.343
		#T4
		100 = GE_reform_cycle.33 #administrative_clergy
		100 = GE_reform_cycle.34
		100 = GE_reform_cycle_monarchy.301 #NEW #Administrative Clergy
		100 = GE_reform_cycle_monarchy.302
		100 = GE_reform_cycle.35 #administrative_nobles
		100 = GE_reform_cycle.36
		100 = GE_reform_cycle.37 #administrative_civilians
		100 = GE_reform_cycle.38
		100 = GE_reform_cycle.39 #integrate_bankers
		100 = GE_reform_cycle.40
		100 = GE_reform_cycle.41 #colonial_gov
		100 = GE_reform_cycle.42
		100 = GE_reform_cycle.43 #fredrickan_reforms
		100 = GE_reform_cycle.44
		100 = GE_reform_cycle.45 #academy_of_science
		100 = GE_reform_cycle.46
		#T5
		100 = GE_reform_cycle.47 #royal_decree
		100 = GE_reform_cycle.48
		100 = GE_reform_cycle.49 #aristocratic_court
		100 = GE_reform_cycle.50
		100 = GE_reform_cycle.51 #general_estates
		100 = GE_reform_cycle.52
		#T6
		100 = GE_reform_cycle.53 #Letat
		100 = GE_reform_cycle.54
		100 = GE_reform_cycle.55 #Regional_representation
		100 = GE_reform_cycle.56
		100 = GE_reform_cycle.57 #Freedom_of_religion
		100 = GE_reform_cycle.58
		100 = GE_reform_cycle.59 #Constitution
		100 = GE_reform_cycle.60
		100 = GE_reform_cycle.61 #Nueva_planta
		1000 = GE_reform_cycle.62
		1000 = GE_reform_cycle.63
		1000 = GE_reform_cycle.64
		#T3.5
		100 = GE_reform_cycle.65 #Feudal_levy
		100 = GE_reform_cycle.66
		150 = GE_reform_cycle_monarchy.3503
		150 = GE_reform_cycle_monarchy.3504
		100 = GE_reform_cycle.67 #Mercenary_corps
		100 = GE_reform_cycle.68
		100 = GE_reform_cycle.69 #Professional_army
		100 = GE_reform_cycle.70
		100 = GE_reform_cycle_monarchy.3501
		200 = GE_reform_cycle_monarchy.3502
		#T7

		#Theocracies

		#T1
		100 = GE_reform_cycle.70 #Leading_Clergy
		100 = GE_reform_cycle.71
		100 = GE_reform_cycle.72
		100 = GE_reform_cycle.73
		#100 = GE_reform_cycle.74

		100 = GE_reform_cycle.76 #Monastic_Order
		100 = GE_reform_cycle.77
		100 = GE_reform_cycle.78
		100 = GE_reform_cycle.79
		100 = GE_reform_cycle.80
		#T2
		100 = GE_reform_cycle.81 #Internal_Mission
		100 = GE_reform_cycle.82
		100 = GE_reform_cycle.83 #External_Mission
		100 = GE_reform_cycle.84
		#T3
		100 = GE_reform_cycle.85 # Holy_Sites
		100 = GE_reform_cycle.86
		100 = GE_reform_cycle.87 # Expell_Heathens
		100 = GE_reform_cycle.88
		100 = GE_reform_cycle.89 # Combat_Heretics
		100 = GE_reform_cycle.90
		#T4
		100 = GE_reform_cycle.91 # Holy_Orthodoxy
		100 = GE_reform_cycle.92
		100 = GE_reform_cycle.93 # Inquisition
		100 = GE_reform_cycle.94
		100 = GE_reform_cycle.95 # Religious_Pragmatism
		100 = GE_reform_cycle.96
		#T5

		#T6
		#100 = GE_reform_cycle.97 # Secular_Law
		#100 = GE_reform_cycle.98
		#100 = GE_reform_cycle.99 # Theocratic_Law
		#100 = GE_reform_cycle.100
		#100 = GE_reform_cycle.101 # Bishops_Law
		#100 = GE_reform_cycle.102

		#7
		#111-118

		#T8
		#119-126

		###Republics###

		##T2##

		#Authoritarianism#
		#100 = GE_reform_cycle_republic.201
		#100 = GE_reform_cycle_republic.202
		#Political Dynasties#
		#100 = GE_reform_cycle_republic.203
		#100 = GE_reform_cycle_republic.204
		#Republicanism#
		#100 = GE_reform_cycle_republic.205
		#100 = GE_reform_cycle_republic.206
		#Mixed Republic
		#50 = GE_reform_cycle_republic.207 #Julius Caesar Event
		#150 = GE_reform_cycle_republic.208
		##T4##

		#Administrative Divisions#
		#100 = GE_reform_cycle_republic.401
		#100 = GE_reform_cycle_republic.402
	}
}

on_new_term_election = {
	events = {
		700		# Election event
		elections.720		# Dutch Republic
		elections.800	# Lottery election
		pirates.1
		# GE:
		elections.7001 #GE
		#GE_electoral_monarchy.1
		GE_electoral_monarchy.2
	}
}

on_death_election = {
	if = {
		limit = { has_reform = presidential_despot_reform }
		remove_government_reform = presidential_despot_reform
	}
	if = {
		limit = {
			has_government_attribute = is_pirate_republic_reform
		}
		set_country_flag = pirate_death_election
		country_event = { id = pirates.1 }
	}
	events = {
		701		# Election event
		elections.721		# Dutch Republic
		elections.800	# Lottery election
		flavor_tus.16 #Savonarola Leaves This World
		# GE:
		elections.7002 #GE
		#GE_electoral_monarchy.1
		GE_electoral_monarchy.2
		reform_me_events.11
	}
}

on_abandon_colony = {
	if = {
		limit = {
			ROOT = {
				has_province_flag = cigars_tax
			}
		}
		add_base_tax = -2
		clr_province_flag = cigars_tax
	}
}

on_colony_established = {
	if = {
		limit = {
			NOT = { has_province_flag = cigars_tax }
			FROM = {
				trading_bonus = {
					trade_goods = cigars
					value = yes
				}
				check_variable = {
					which = tobacco_total 
					which = tobacco_used
				}
			}	
		}
		set_province_flag = cigars_tax
		add_base_tax = 2
	}
}

on_diplomatic_annex = {
	FROM = {
		update_goods_subjects_province = { GOODS = copper }
		update_goods_subjects_province = { GOODS = tin }
		update_goods_subjects_province = { GOODS = iron }
		update_goods_subjects_province = { GOODS = zinc }
		update_goods_subjects_province = { GOODS = lead }
		update_goods_subjects_province = { GOODS = glass }
		update_goods_subjects_province = { GOODS = tobacco }
		update_goods_subjects_province = { GOODS = cocoa }
	}
	events = {
		610
		appanages_event.1
	}
	FRA = { 
		if = {
			limit = {
				has_estate_privilege = estate_nobles_french_strong_duchies
				NOT = { 
					any_subject_country = {
						capital_scope = { region = france_region }
						culture_group = french
					}
				}
			}
			remove_estate_privilege = estate_nobles_french_strong_duchies
		}
	}
}

on_trade_good_changed = {
	on_trade_good_changed_estate_privileges_effect = yes
	on_trade_good_changed_government_effect_TGE = yes
	
	
	if = {
		limit = {
			ROOT = { trade_goods = silver }
			NOT = { has_province_modifier = silver_debuff }
		}
		ROOT = {
			add_province_modifier = { 
				name = silver_debuff
				duration = -1
				hidden = yes	
			}
		}
	}
	
	
	if = {
		limit = { 
			ROOT = { 
				AND = {
					NOT = { trade_goods = silver }
					has_province_modifier = silver_debuff
				}
			}
		}
		remove_province_modifier = silver_debuff
	}
	
	if = {
		limit = { 
			ROOT = { 
				AND = {
					has_province_modifier = copper_mine
					has_province_modifier = copper_mine_small
					has_province_modifier = tin_mine
					has_province_modifier = tin_mine_small
					has_province_modifier = zinc_mine
					has_province_modifier = zinc_mine_small
					has_province_modifier = iron_mine
					has_province_modifier = iron_mine_small
					has_province_modifier = lead_mine
					has_province_modifier = lead_mine_small
				}
			}
		}
		remove_province_modifier = copper_mine
		remove_province_modifier = copper_mine_small
		remove_province_modifier = tin_mine
		remove_province_modifier = tin_mine_small
		remove_province_modifier = zinc_mine
		remove_province_modifier = zinc_mine_small
		remove_province_modifier = iron_mine
		remove_province_modifier = iron_mine_small
		remove_province_modifier = lead_mine
		remove_province_modifier = lead_mine_small
		clr_province_flag = has_mine
	}
	
	if = {
		limit = {
			ROOT = { 
				trade_goods = indigo 
				continent = europe
			}
			NOT = { has_province_modifier = woad_type }
		}
		ROOT = {
			add_permanent_province_modifier = { 
				name = woad_type
				duration = -1  
				desc = woad_type_tooltip
			}
		}
	}
	if = {
		limit = { 
			ROOT = { 
				AND = {
					NOT = { trade_goods = indigo }
					OR = {
						has_province_modifier = woad_type
						has_province_modifier = woad_type_bad
					}
				}
			}
		}
		remove_province_modifier = woad_type
		remove_province_modifier = woad_type_bad
	}
	
	if = {
		limit = {
			ROOT = { trade_goods = metalworking }
			NOT = { has_global_flag = metalworking_start }
		}
		ROOT = { province_event = { id = prices_marcin.15 days = 1 } }
		set_global_flag = metalworking_start
	}
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_cannon
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = cannon
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_metalworking
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = metalworking
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_steam_engine
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = steam_engine
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_optics
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = optics
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_munitions
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = munitions
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_munitions
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = munitions
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_chocolate
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = chocolate
		}
	}
	
	if = {
		limit = {
			ROOT = {
				has_province_flag = has_cigars
			}
		}
		ROOT = {
			goods_save = yes
			change_trade_goods = cigars
		}
	}
	
	
}

on_dependency_gained = {
	run_on_dependency_gained_compatability_effects = yes
	update_monuments_self = yes
	FROM = { update_monuments_self = yes }
}

on_great_project_constructed = {
	update_monuments_self = yes
}


on_raze = { #ROOT - province owner = razing country
	add_permanent_province_modifier = {
		name = province_razed
		duration = 7300
	}

	owner = {
		change_variable = {
			which = num_of_provinces_razed_var
			value = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_scourge_of_god_counter
			}
			development = 10
		}
		owner = {
			change_variable = {
				which = METimRazedHighDevProvinces
				value = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_skull_pyramid_unlocked
				owns_core_province = 446
			}
		}
		446 = {
			change_variable = {
				which = METimSkullPyramidProgress
				value = 1
			}
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_more_gold_razing
			}
		}
		owner = {
			add_treasury = 5
		}
	}
	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_razing_provinces_mercantilism
			}
			has_trade_building_trigger = yes
		}
		owner = {
			add_mercantilism = 0.5
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_churches_money_raze
			}
			has_tax_building_trigger = yes
		}
		owner = {
			add_treasury = 50
		}
	}

	if = {
		limit = {
			owner = {
				has_government_attribute = enables_spoils_of_war
				NOT = { has_country_flag = ME_tim_battle_tendency_mission_flag }
			}
		}
		ME_tim_add_spoils_of_war = { add = 1 }
	}
	else_if = {
		limit = {
			owner = {
				has_government_attribute = enables_spoils_of_war
				has_country_flag = ME_tim_battle_tendency_mission_flag
			}
		}
		ME_tim_add_spoils_of_war = { add = 3 } #When you combine it with the below one, it ends up being +4, aka double. Not the best way, but I will not be rewriting the code
	}
	if = {
		limit = {
			owner = {
				has_government_attribute = enables_spoils_of_war
				has_country_flag = me_tim_double_sow_razing
			}
		}
		ME_tim_add_spoils_of_war = { add = 1 }
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_scourge_of_god_counter
			}
			development = 15
		}
		change_variable = {
			which = METimRazedHighDevProvinces
			value = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_horde_path
			}
			region = arabia_region
		}
		owner = {
			change_variable = {
				which = METimArabianProvincesRazed
				value = 1
			}
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_razing_destroys_province
			}
		}
		set_base_production = 0
		set_base_manpower = 0
		set_base_tax = 0
		decolonize = THIS
		set_province_flag = me_tim_wasteland
	}
}

on_expanded_infrastructure = {
    if = {
        limit = {
            owner = {
                mission_completed = EE_syn_human_governments
            }
        }
        owner = {
            change_government_reform_progress = 2
        }
    }
}

on_concentrate_development = {
    if = { 
		limit = { 
			owner = { has_country_modifier = fra_french_isles_modifier }
		}
		add_nationalism = -5
	}
	
	# ME Stuff
	if = {
        limit = {
            owner = {
                mission_completed = EE_syn_construction_efforts
            }
        }
        owner = {
            add_years_of_income = 0.5
            ME_distribute_development = {
                type = production
                amount = 1
            }
            ME_distribute_development = {
                type = tax
                amount = 1
            }
            ME_distribute_development = {
                type = manpower
                amount = 1
            }
        }
    }
}

on_monarch_death = {
	if = {
		limit = {
			tag = ANS
			BRA = {
				has_country_flag = albrecht_achilles_flag
			}
		}
		BRA = {
			clr_country_flag = albrecht_achilles_flag #Just to be sure
			kill_heir = {} #If Albrecht Achilles dies in Ansbach he will also be dead in Brandenburg, will appear as normal death of heir to BRA.
		}
	}
	
	if = {
		limit = { has_country_modifier = sought_after_bachelor }
		remove_country_modifier = sought_after_bachelor
	}
	if = {
		limit = {
			tag = SAX
			has_country_flag = sax_thuringen_split_to_happen
			OR = {
				NOT = { dynasty = "von Wettin" }
				NOT = { senior_union_with = THU }
				has_regency = yes
			}
		}
		clr_country_flag = sax_thuringen_split_to_happen
	}
	if = {
		limit = { tag = SAM }
		country_event = { id = polynesian.35 }
	}
	if = {
		limit = { tag = TOG }
		country_event = { id = polynesian.36 }
	}
	if = {	# Ascension of Trailokanat
		limit = { tag = AYU }
		country_event = { id = flavor_suk.1 }
	}
	if = {
		limit = { tag = GOT }
		country_event = { id = flavor_got.37 }
	}
	if = {
		limit = { has_government_attribute = no_stability_loss_on_monarch_death }
		add_stability = 1
	}
	
	burgundian_inheritance_start_effect = yes
	ladislaus_postumus_king_died_effect = yes
	joan_de_trastamara_king_died_effect = yes
	events = {
		flavor_wal.1 # Vlad the Impaler. So that he doesn't try to usurp his father.
		flavor_nav.4 # Navarra succession event
		flavor_sax.8 # Treaty of Leipzig
		flavor_pap.16 # Borgia Pope
		flavor_pap.19 # death of borgia pope
		flavor_tus.22 # Medici Pope
		flavor_tus.24 # death of the Medici Pope
		majapahit.8 # Majapahit pretenders
		flavor_mal.11 # Mali pretenders
		flavor_mal.47 # Pilgrimage ends prematurely
		government_events.3	# Election of a new Ruler

		# GE:
		#reform_me_events.11
		GE_electoral_monarchy.4
        reform_me_events.240
		#GE_electoral_monarchy.1

		ME_Spain_Events.8
		ME_Reform_Events.1
		ME_Mzab_Events.2
		ME_Korea_Events.6
		ME_Korea_Events.8
	}
	
	random_events = {
		#100 = 0
		100 = 0
		900 = ME_Mamluks_Events.21
	}
	# EE:
	if = {
		limit = {
			has_ruler_flag = Ulugh_beg_is_ruler
		}
		ROOT = {
			country_event = { id = ME_Timurid_Princes_Event.11 }
		}
	}
	if = {
		limit = {
			tag = CRI
			is_subject_of_type = timar
		}
		TUR = {
			country_event = { id = ME_Crimea_Events.1 }
		}
	}
	if = {
		limit = {
			has_reform = west_slavic_monarchy
			NOT = { has_country_flag = ME_FFS_STAP }
		}
		set_country_flag = ME_FFS_STAP
		country_event = { id = ME_Zapadoslavia_Events.9 }
	}
	if = {
		limit = {
			tag = ERE
			mission_completed = ERE_tombs
		}
		random_owned_province = {
			province_event = {
				id = ME_Beylik_Events.14
			}
		}
	}
	
	if = {
		limit = {
			has_ruler_flag = Ulugh_beg_is_ruler
		}
		ROOT = {
			country_event = { id = ME_Timurid_Princes_Event.11 }
		}
	}
	complete_mission = me_tim_regency
	
	if = {
		limit = {
			tag = TIM
			has_global_flag = tim_successor
		}
		event_target:me_tim_successor = {
			country_event = { id = ME_Timurid_Princes_Event.20 }
		}
		clr_global_flag = tim_successor
	}
	else_if = {
		limit = {
			tag = TIM
			has_global_flag = prince_successor
		}
		event_target:me_tim_successor = {
			country_event = { id = ME_Timurid_Princes_Event.19 }
		}
		clr_global_flag = prince_successor
	}
	else_if = {
		limit = {
			tag = TIM
			has_country_flag = ME_TIM_no_successor
		}
		country_event = { id = ME_Timurid_Princes_Event.12 }
	}
	else = { } #don't complain error log.
	
	if = {
		limit = {
			has_country_flag = me_subah_mechanic
		}
		every_owned_province = {
			limit = {
				has_province_modifier = me_mug_subah_focus
			}
			remove_province_modifier = me_mug_subah_focus
		}
		remove_country_modifier = me_mug_hindu_subah
		remove_country_modifier = me_mug_hindu_subah_negative
		remove_country_modifier = me_mug_bengal_subah
		remove_country_modifier = me_mug_bengal_subah_negative
		remove_country_modifier = me_mug_rajput_subah
		remove_country_modifier = me_mug_rajput_subah_negative
		remove_country_modifier = me_mug_gujarat_subah
		remove_country_modifier = me_mug_gujarat_subah_negative
		remove_country_modifier = me_mug_malwa_subah_bonus
		remove_country_modifier = me_mug_malwa_subah_negative
		remove_country_modifier = me_mug_deccan_subah_bonus
		remove_country_modifier = me_mug_deccan_subah_malus
		
		country_event = { id = ME_Mughal_Events.23 }
	}
	
	if = {
		limit = {
			has_heir_flag = QAR_fulad
		}
		clr_heir_flag = QAR_fulad
		country_event = { id = ME_Qara_Qoyunlu_Events.7 }
	}
	
	if = {
		limit = {
			tag = HAB
		}
		country_event = { id = me_austria_nobles.1 }
	}
	
	if = {
		limit = {
			has_reform = west_slavic_monarchy
			NOT = { has_country_flag = ME_FFS_STAP }
		}
		set_country_flag = ME_FFS_STAP
		country_event = { id = ME_Zapadoslavia_Events.9 }
	}
	if = {
		limit = {
			tag = ERE
			#mission_completed = ERE_tombs
		}
		random_owned_province = {
			province_event = {
				id = ME_Beylik_Events.14
			}
		}
	}
	if = {
		limit = {
			has_country_flag = me_hab_iron_fist_flag
		}
		ROOT = {
			change_variable = { #To count how many ruler deaths have happened
				which = MEIronFistVar
				value = 1
			}
			if = {
				limit = {
					check_variable = { #To count how many ruler deaths have happened
						which = MEIronFistVar
						value = 1
					}
				}
				clr_country_flag = me_hab_iron_fist_flag
				every_owned_province = {
					remove_province_modifier = me_hab_iron_fist
				}
			}
		}
	}
	
	if = {
		limit = {
			is_emperor = yes
		}
		ROOT = {
			me_decrease_emperor_of_romans_level = yes
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_conquer_iberia
		}
		clr_country_flag = me_hab_conquer_iberia
		break_union = CAS
		break_union = SPA
		break_union = POR
		break_union = ARA
	}
	if = {
		limit = {
			dip = 0
			NOT = { dip = 1 }
			has_country_flag = me_tim_caravan_modifier
		}
		ME_add_caravan_modifier = { level = 0 }
	}
	else_if = {
		limit = {
			dip = 1
			NOT = { dip = 2 }
			has_country_flag = me_tim_caravan_modifier
		}
		ME_add_caravan_modifier = { level = 1 }
	}
	else_if = {
		limit = {
			dip = 2
			NOT = { dip = 3 }
			has_country_flag = me_tim_caravan_modifier
		}
		ME_add_caravan_modifier = { level = 2 }
	}
	else_if = {
		limit = {
			dip = 3
			NOT = { dip = 4 }
			has_country_flag = me_tim_caravan_modifier
		}
		ME_add_caravan_modifier = { level = 3 }
	}
	else_if = {
		limit = {
			dip = 4
			NOT = { dip = 5 }
			has_country_flag = me_tim_caravan_modifier
		}
		ME_add_caravan_modifier = { level = 4 }
	}
	else_if = {
		limit = {
			dip = 5
			NOT = { dip = 6 }
			has_country_flag = me_tim_caravan_modifier
		}
		ME_add_caravan_modifier = { level = 5 }
	}
	else_if = {
		limit = {
			dip = 6
			has_country_flag = me_tim_caravan_modifier
		}
		ME_add_caravan_modifier = { level = 6 }
	}
	
	if = {
		limit = {
			has_country_flag = me_tim_picked_regency
		}
		restore_country_name = yes
	}
}

on_new_monarch = {
	on_new_monarch_effect = yes
	crimean_succession_effect = yes #Scripted effect
	slesvig_question_effect = yes #Scripted effect
	# ambrosian_republic_effect = yes
	succession_culture_religion_effect = yes
	sheik_ul_islam_effect = yes
	hab_remove_mission_mods_if_not_emperor_effect = yes
	thu_remain_von_wettin_effect = yes
	ladislaus_postumus_union_effect = yes
	events = {
		tribal_succession.1		# Harsh anti-tribals.
		9492 					# Remove some event modifiers
		flavor_boh.8			# Winter King in Prague
		flavor_kol.1			# Bavarian Archbishop
		war_of_the_roses.101	# WotR - House of Lancaster wins
		war_of_the_roses.102	# WotR - House of York wins
		war_of_the_roses.106	# WotR - Another dynasty has seized the throne
		flavor_tur.102			# Janissary Reward
		flavor_ori.7			# Hamvira Victorious
		flavor_kbo.1			# The two branches of the Sayfawa dynasty
		flavor_kbo.8			# Sayfawa pretenders
		flavor_zan.5			# Coup of Coup of Suleiman and Muhammad al-Mazlum.
		purple_phoenix.1		# BYZ pretenders
		flavor_pol.3480			# The Pacta Conventa
		protestantism_events.15	# Catholic Leaning Monarch
		tengri_events.17		# Keep the Khojas in Power?
		flavor_tus.15			# Savonarola Dies
		flavor_brapru.22		# Succession of Albrecht Achilles
		flavor_brapru.25		# Dispositio Achillea (can also trigger from flavor_brapru.22)
		flavor_nor.27			# Proclamation in Hamar
		china_events.43			# Picking new Capital for China
		celestial_empire_events.3 #Resistance to Sinicization
		flavor_boh.2			#Heretic Kings
		flavor_hun.17			#Maintaining the Black Army
		flavor_tim.1			#Death of Shah Rukh
		muslim_school_events.20 #No Religious School
		flavor_daimyo.4			#Shiba Yoshikado
		flavor_fra.9000			# Fran√ßois Villon
		flavor_sca.2			# Education Focus of the new Ruler
		flavor_rus.128			# Peter the Great
		flavor_rus.131			# Streltsy Payment
		flavor_gbr.102			# Religious Stance of the King
	}
	random_events = {
		1000 = 0
		100 = flavor_kol.1		# Bavarian Archbishop
		100 = flavor_hsa.3		# Hansa: Tagfahrt
		100 = inti_events.1		# Birth of a Panaca
		50 = dynastic_events.4
		50 = dynastic_events.5
		25 = harem_events.7		#Failed Policy of Fratricide
	}

	if = {
		limit = {
			is_lesser_in_union = no
			valid_for_personal_unions_trigger = yes
			any_known_country = {
				valid_for_personal_unions_trigger = yes
				NOT = { has_country_flag = valid_to_claim_succession_war_against_@ROOT }
				ROOT = {
					OR = {
						dynasty = PREV
						has_ruler_flag = was_heir_from_@PREV
					}
				}
			}
		}
		every_known_country = {
			limit = {
				valid_for_personal_unions_trigger = yes
				NOT = { has_country_flag = valid_to_claim_succession_war_against_@ROOT }
				ROOT = {
					OR = {
						AND = {
							dynasty = PREV
							has_regency = no
							PREV = {
								OR = {
									has_regency = no
									AND = {
										has_heir = yes
										heir_dynasty = ROOT
									}
								}
							}
						}
						has_ruler_flag = was_heir_from_@PREV
					}
				}
			}
			set_country_flag = valid_to_claim_succession_war_against_@ROOT
		}
	}
	
	#ME Stuff
	if = {
		limit = {
			has_country_flag = me_tim_ruler_timer
			NOT = {
				had_country_flag = {
					flag = me_tim_ruler_timer
					days = 5475
				}
			}
		}
		add_country_modifier = {
			name = me_mug_failed_coinage_reforms
			duration = 5475
		}
		clr_country_flag = me_tim_ruler_timer
	}

	if = {
		limit = {
			mission_completed = EE_syn_synthetic_dawn
		}
		add_adm_power = 200
		add_dip_power = 200
		add_mil_power = 200
	}
}

on_new_heir = {
	# Vanilla:
	if = {
		limit = { has_any_heir_cult_active = yes }
		remove_heir_cult = yes
	}
	if = {
		limit = {
			has_country_flag = enabled_cult_for_heirs
		}
		country_event = {
			id = fetishist_flavor.600
		}
	}
	if = {
		limit = {
			has_country_flag = had_bmv
		}
		clr_country_flag = had_bmv
	}

	# For PTE:
	if = {
		limit = {
			is_lesser_in_union = no
			valid_for_personal_unions_trigger = yes
			OR = {
				AND = {
					has_dlc = "Rights of Man"
					has_consort = yes
					OR = {
						can_heir_be_child_of_consort = yes
						NOT = { heir_age = 1 }
					}
					any_known_country = {
						has_given_consort_to = ROOT
						NOT = { has_country_flag = valid_to_claim_succession_war_against_@ROOT }
						ROOT = {
							NOT = { has_heir_flag = was_heir_from_@PREV }
						}
					}
				}
				AND = {
					NOT = { has_dlc = "Rights of Man" }
					NOT = { heir_age = 1 }
					num_of_royal_marriages = 1
					any_known_country = {
						marriage_with = ROOT
						NOT = { has_country_flag = valid_to_claim_succession_war_against_@ROOT }
						ROOT = {
							NOT = { has_heir_flag = was_heir_from_@PREV }
							heir_culture = PREV
							heir_religion = PREV
						}
					}
				}
			}
		}
		every_known_country = {
			limit = {
				NOT = { has_country_flag = valid_to_claim_succession_war_against_@ROOT }
				ROOT = {
					NOT = { has_heir_flag = was_heir_from_@PREV }
				}
				OR = {
					AND = {
						has_dlc = "Rights of Man"
						has_given_consort_to = ROOT
					}
					AND = {
						NOT = { has_dlc = "Rights of Man" }
						marriage_with = ROOT
						ROOT = {
							heir_culture = PREV
							heir_religion = PREV
						}
					}
				}
			}
			ROOT = {
				set_heir_flag = was_heir_from_@PREV
			}
		}
	}
}

on_raid_coast = {
	if = {
		limit = {
			has_faction = pr_buccaneers
		}
		add_faction_influence = {
			faction = pr_buccaneers
			influence = 1
		}
	}
	if = {
		limit = {
			has_government_attribute = raiding_increases_pp
		}
		add_power_projection = {
			type = high_sea_power_projection
			amount = 1
		}
	}
	if = {
		limit = {
			has_mission = dan_raid_the_north_sea
			NOT = { mission_completed = dan_raid_the_north_sea } 
		}
		change_variable = {
			which = num_of_raided_coasts
			value = 1
		}
	}

	# For PTE:
	FROM = {
		every_neighbor_province = {
			limit = {
				has_port = yes
				is_empty = no
				has_province_modifier = slaves_raided
				NOT = { owned_by = ROOT }
				owner = {
					is_free_or_tributary_trigger = yes
					has_opinion_modifier = {
						who = ROOT
						modifier = slaves_raided
					}
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = slaves_raided
							value = -24
						}
					}
				}
			}
			owner = {
				if = {
					limit = {
						NOT = {
							has_casus_belli = {
								target = ROOT
								type = cb_pte_stop_raiding
							}
						}
					}
					add_casus_belli = {
						target = ROOT
						type = cb_pte_stop_raiding
					}
				}
			}
		}
	}
	
	# ME Stuff
	if = { 
		limit = { has_country_flag = nss_raid_for_pp_flag } 
		add_power_projection = {
			type = mission_rewards_power_projection
			amount = 1
		}
	}
	save_event_target_as = Temp_THIS
	ME_on_raid_coast_sea_effect = yes
	FROM = {
		every_neighbor_province = {
			limit = {
				NOT = { is_sea = yes }
			}
			event_target:Temp_THIS = { 
				ME_on_raid_coast_province_effect = yes
			}
		}
	}
}

on_main_war_won = {
	on_main_war_won_effect = yes
	events = {
		native_americans.7
		flavor_kor.15
	}
	# GE:
	ge_on_main_war_won_effect = yes
}

# province
on_religion_change = {
	remove_country_modifier = RRR_roman_counter_reformation_modifier
	remove_country_modifier = RRR_weakened_papal_influence
	remove_country_modifier = RRR_roman_reformation_modifier
}
on_defender_of_faith_loss = {
	remove_country_modifier = RRR_sword_catholic
	remove_country_modifier = mfa_rivals_of_catholicism
	remove_country_modifier = RRR_vanguards_of_the_reformation
}
on_defender_of_faith_claim = {
	if = {
		limit = {
			has_country_flag = RRR_sword_catholic_flag
			religion = catholic
		}
		add_country_modifier = {
			name = "RRR_sword_catholic"
			duration = -1
		}
	}
	if = {
		limit = {
			has_country_flag = BBF_mfa_rivals_of_catholicism_flag
		}
		add_country_modifier = {
			name = "mfa_rivals_of_catholicism"
			duration = -1
			desc = BBF_defender_of_faith_kept_tt
		}
	}
	if = {
		limit = {
			has_country_flag = RRR_vanguards_of_the_reformation_flag
		}
		add_country_modifier = {
			name = "RRR_vanguards_of_the_reformation"
			duration = -1
			desc = BBF_defender_of_faith_kept_tt
		}
	}
}

on_adm_development = {
	on_adm_development_effect = yes
	if = {
		limit = { owner = { has_country_flag = enable_supplemental_development_flag } }
		random_list = {
			20 = { add_base_tax = 1 }
			80 = { }
		}
	}
	if = {
		limit = { 
			owner = { has_country_modifier = lit_increased_dev_modifier }
		}
		add_base_tax = 1 
	}
	if = { 
		limit = { has_state_edict = chinese_industrialization } 
		random_list = {
			10 = { add_base_tax = 1 } 
			10 = { add_prosperity = 1 } 
			10 = { add_province_modifier = { name = qng_center_of_industrialization_modifier duration = 3650 } }
			70 = {  } 
		}
	}
	if = {
		limit = { owner = { has_country_modifier = JAP_cadastral_surveys has_dlc = "Domination" } }
		owner = {
			change_estate_land_share = {
				estate = all 
				share = -0.2
			}
		}
	}
	
	if = {
		limit = { owner = { has_country_modifier = jap_20_years_devving_tax_yields_twice_bonus_1_burgher_loyalt_modifier } }
		add_base_tax = 1 
		owner = {
			add_estate_loyalty = {
				estate = estate_burghers 
				loyalty = 1 
			}
		}
	}
	
	if = { 
		limit = { 
			owner = { has_country_modifier = pru_victory_lower_saxony_modifier }
			OR = { 
				culture = saxon
				culture = lower_saxon
			}
		}
		add_nationalism = -3
		add_local_autonomy = -5
		add_prosperity = 1
	}
	
	#ME Stuff
	
	ME_on_development = yes
	owner = {
		change_variable = {
			which = num_of_adm_clicks
			value = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = ARB_extra_base_tax
			}
		}
		owner = {
			random_owned_province = {
				add_base_tax = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = polish
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_tax = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_estate_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			culture = armenian
			owner = {
				OR = {
					has_mission = QAR_catholicoi
					tag = QAR
					was_tag = QAR
				}
			}
		}
		owner = {
			change_variable = {
				which = QAR_developed_armenia
				value = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}

	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_tax = 1 } 
			90 = { } 
		}
	}
	if = {
		limit = {
			owner = {
				has_country_flag = ORM_deving_adm_in_trade_center
			}
		}
		owner = {
			add_mercantilism = 1
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}
	if = {
        limit = {
			owner = {
				has_country_flag = me_mug_dashala
			}
        }
        random = {
            chance = 50
            add_base_tax = 1
        }
    }
	if = {
		limit = {
			owner = { mission_completed = EE_syn_development_efforts }
		}
		add_base_tax = 1
	}
}

# province
on_dip_development = {
	on_dip_development_effect = yes

	if = { 
		limit = { 
			owner = { has_country_modifier = pru_victory_lower_saxony_modifier }
			OR = { 
				culture = saxon
				culture = lower_saxon
			}
		}
		add_nationalism = -3
		add_local_autonomy = -5
		add_prosperity = 1
	}

	if = {
		limit = {
			OR = {
				trade_goods = copper
				trade_goods = tin
				trade_goods = iron
				trade_goods = zinc
				trade_goods = lead
				trade_goods = glass
				trade_goods = cocoa
				trade_goods = tobacco
			}
		}
		if = {
			limit = { 
				NOT = { has_province_modifier = import_from_subjects_modifier } 
			}
			owner = {
				country_event = { 
					id = New_TradeGood_Events.2
					days = 1
				}
			}
		}
		else_if = {
			limit = {
				has_province_modifier = import_from_subjects_modifier
			}
			owner = {
				country_event = { 
					id = New_TradeGood_Events.2
					days = 4
				}
				overlord = { 
					country_event = { 
						id = New_TradeGood_Events.2
						days = 4
					}
				}
			}
			if = {
				limit = { trade_goods = copper  }
				update_goods_subjects = { GOODS = copper }
			}
			else_if = {
				limit = { trade_goods = tin  }
				update_goods_subjects = { GOODS = tin }
			}
			else_if = {
				limit = { trade_goods = iron  }
				update_goods_subjects = { GOODS = iron }
			}
			else_if = {
				limit = { trade_goods = lead }
				update_goods_subjects = { GOODS = lead }
			}
			else_if = {
				limit = { trade_goods = zinc  }
				update_goods_subjects = { GOODS = zinc }
			}
			else_if = {
				limit = { trade_goods = glass  }
				update_goods_subjects = { GOODS = glass }
			}
			else_if = {
				limit = { trade_goods = cocoa  }
				update_goods_subjects = { GOODS = cocoa }
			}
			else_if = {
				limit = { trade_goods = tobacco  }
				update_goods_subjects = { GOODS = tobacco }
			}
		}
	}
	
	# ME Stuff
	ME_on_development = yes
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = polish
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_grain_double_dev
			}
		}
		random = { 
			chance = 50 

			add_base_production = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_production = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_estate_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_production = 1 } 
			90 = { } 
		}
	}
	if = {
		limit = {
			owner = { mission_completed = EE_syn_development_efforts }
		}
		add_base_production = 1
	}

	if = {
		limit = {
			culture = armenian
			owner = {
				OR = {
					has_mission = QAR_catholicoi
					tag = QAR
					was_tag = QAR
				}
			}
		}
		owner = {
			change_variable = {
				which = QAR_developed_armenia
				value = 1
			}
		}
	}
}

# province
on_mil_development = {
	on_mil_development_effect = yes

	if = { 
		limit = { 
			owner = { has_country_modifier = pru_victory_lower_saxony_modifier }
			OR = { 
				culture = saxon
				culture = lower_saxon
			}
		}
		add_nationalism = -3
		add_local_autonomy = -5
		add_prosperity = 1
	}

	# ME Stuff 
	ME_on_development = yes
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				OR = {
					culture = polish
					culture = schlesian
				}
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_manpower = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_estate_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_manpower = 1 } 
			90 = { } 
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}

	if = {
		limit = {
			owner = { mission_completed = ME_tim_national_militias }
		}
		random_list = { 
			10 = { add_base_manpower = 1 } 
			90 = { } 
		}
	}
	if = {
		limit = {
			owner = { mission_completed = EE_syn_development_efforts }
		}
		add_base_manpower = 1
	}

	if = {
		limit = {
			culture = armenian
			owner = {
				OR = {
					has_mission = QAR_catholicoi
					tag = QAR
					was_tag = QAR
				}
			}
		}
		owner = {
			change_variable = {
				which = QAR_developed_armenia
				value = 1
			}
		}
	}
}

on_province_culture_converted = {
	on_province_culture_converted_estate_privilges_effect = yes
	judaism_on_province_culture_converted_effect = yes
	imperial_modifiers_on_province_change_culture_or_change_owner_effect = yes
	on_province_culture_change_effect = yes
	
	# ME Stuff
	
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 1 }
			}
		}
		else_if = {
			limit = {
				OR = {
					culture = polish
					culture = schlesian
				}
			}
			owner = {
				change_variable = { ME_polish_loyalty = 1 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 1 }
			}
		}
	}
	owner = {
		change_variable = { num_of_culture_converted_provinces = 1 }
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			culture_group = ROOT
		}
		remove_province_modifier = me_hab_development_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			NOT = { culture_group = ROOT }
		}
		add_province_modifier = {
			name = me_hab_development_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			culture_group = ROOT
		}
		remove_province_modifier = me_hab_conscription_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			NOT = { culture_group = ROOT }
		}
		add_province_modifier = {
			name = me_hab_conscription_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_estate_privilege = estate_turkic_tribes_settle_the_tribes
			}
			culture = owner
		}
		owner = {
			add_estate_loyalty = {
				estate = estate_turkic_tribes
				loyalty = 5
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_tim_persian_empire
				primary_culture = persian
			}
			
		}
		add_province_modifier = {
			name = me_tim_persian_empire_province
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_modifier = me_tim_persian_empire
				NOT = { primary_culture = persian }
			}
		}
		remove_province_modifier = me_tim_persian_empire_province
	}
}

on_primary_culture_changed = {
	on_primary_culture_changed_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_primary_culture_change_effect = yes
	
	if = {
		limit = {
			primary_culture = persian
			NOT = { has_country_modifier = me_tim_persian_empire }
			has_country_flag = me_tim_persian_empire_flag
		}
		add_country_modifier = {
			name = me_tim_persian_empire
			duration = -1
			desc = me_tim_until_we_are_not_persian
		}
		every_owned_province = {
			limit = {
				culture = ROOT
			}
			add_province_modifier = {
				name = me_tim_persian_empire_province
				duration = -1
				hidden = yes
			}
		}
	}
	else_if = {
		limit = {
			NOT = { primary_culture = persian }
			has_country_modifier = me_tim_persian_empire
		}
		remove_country_modifier = me_tim_persian_empire
		set_country_flag = me_tim_persian_empire_flag
		every_owned_province = {
			limit = {
				culture = ROOT
			}
			remove_province_modifier = me_tim_persian_empire_province
		}
	}
	remove_country_modifier = MOE_greek_nationalism_modifier
}


# ROOT = Tag that captured the flagship, FROM = Tag that lost the flagship
on_flagship_captured = {
	FROM = {
		set_country_flag = captured_flagship_country_flag
	}
	ROOT = {
		country_event = { id = flagship_events.2 }
		set_country_flag = trophy_hunter_flag
	}
	FROM = {
		country_event = { id = flagship_events.1 }
	}
	FROM = { 
		if = { 
			limit = { has_country_modifier = hsa_pride_eagle_of_the_fleet_modifier }
			remove_country_modifier = hsa_pride_eagle_of_the_fleet_modifier
		}
	}
}

# ROOT = winning country, FROM = loser country
on_battle_won_country = {
	#on_battle_ended_effect = yes
	on_battle_won_country_effect = yes
	if = {
		limit = {
			ROOT = {
				tag = ALB
				NOT = { has_country_flag = albanian_victory }
			}
			FROM = {
				tag = TUR
			}
		}
		ROOT = { set_country_flag = albanian_victory }
	}
	count_won_battles_and_reward_at_end = {
		counting_flag = teu_crusader_battle_counter
		max_value = 20
		effect = "
			country_event = {
				id = flavor_teu.12
			}
		"
	}
	count_won_battles_and_reward_at_end = {
		counting_flag = has_rus_kill_counter
		max_value = 40
		effect = "set_country_flag = rus_finished_kill_mission"
	}
	
	#ME Stuff
	if = {
		limit = {
			mission_completed = EE_syn_robot_army
		}
		add_adm_power = 10
		add_dip_power = 10
		add_mil_power = 10
	}
	if = {
		limit = {
			tag = ILK
			FROM = {
				tag = MAM
			}
		}
		country_event = { id = ME_Ilkhanate_Events.8 }
	}
	if = {
		limit = {
			mission_completed = takeda_rise_of_takeda_shingen
		}
		change_variable = { which = num_of_won_battles value = 1 }
	}
	
	if = {
		limit = {
			has_country_modifier = me_hab_imperial_marshall
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	if = {
		limit = {
			has_country_flag = GRA_incident_castile
			FROM = { tag = CAS }
		}
		change_variable = { which = Granada_battles_won value = 1 }
	}
	if = {
		limit = {
			has_country_modifier = MSY_the_end_is_nigh
		}
		add_disaster_progress = {
			disaster = ME_the_end_of_times
			value = -0.5
		}
	}
	if = {
		limit = {
			has_country_flag = RUM_pp_from_battles
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = RUM_our_discipline
					value = trigger_value:discipline
				}
				export_to_variable = {
					which = RUM_their_discipline
					value = trigger_value:discipline
					who = FROM
				}
				check_variable = {
					which = RUM_their_discipline
					which = RUM_our_discipline
				}
			}
		}
		add_power_projection = {
			type = RUM_battles
			amount = 1
		}
	}
	if = {
		limit = {
			has_country_flag = ME_can_use_timurid_legitimacy
		}
		change_variable = {
			which = timurid_legitimacy_value
			value = 2
		}
	}
	
	change_variable = {
		which = num_of_battles_won_var
		value = 1
	}
	if = {
		limit = {
			OR = {
				AND = {
					mission_completed = TIM_every_corner
					mission_completed = TIM_elephants_for_governors
				}
				AND = {
					overlord = {
						mission_completed = TIM_every_corner
						mission_completed = TIM_elephants_for_governors
					}
				}
			}
		}
		change_variable = {
			which = METimBattlesWonFinal
			value = 1
		}
	}
	
	if = {
		limit = {
			mission_completed = TIM_conquerors_legacy
			NOT = { mission_completed = TIM_emperors_guard }
		}
		change_variable = {
			which = ME_tim_emperors_guard_counter
			value = 1
		}
	}
	if = {
		limit = {
			has_government_attribute = enables_spoils_of_war
			NOT = { has_country_flag = ME_tim_battle_tendency_mission_flag }
		}
		ME_tim_add_spoils_of_war = { add = 1 }
	}
	else_if = {
		limit = {
			has_government_attribute = enables_spoils_of_war
			has_country_flag = ME_tim_battle_tendency_mission_flag
		}
		ME_tim_add_spoils_of_war = { add = 2 }
	}

	if = {
		limit = {
			mission_completed = ME_tim_army_with_a_state
		}
		add_government_power = {
			mechanic_type = timurid_militarization
			power_type = timurid_stratocracy_power
			value = 2
		}
	}

	if = {
		limit = {
			mission_completed = ME_tim_army_professionalism
		}
		add_army_professionalism = 0.002
	}
}

on_battle_won_unit = {
	on_battle_won_unit_effect = yes
	if = {
		limit = {
			unit_owner = { ai = no } #Scopes to Unit Owner from Unit Scope
			general_with_steam_name = yes #Unit Scope Trigger
		}
		unit_owner = { set_country_flag = general_with_steam_name_won_battle }
	}
	if = {
		limit = {
			general_with_name = "Damarwulan"
		}
		unit_owner = {
			change_variable = {
				which = DamarwulanWinVariable 
				value = 1
			}
		}
	}
	if = {
		limit = {
			general_with_name = "Damarwulan"
			unit_owner = {
				check_variable = {
					which = DamarwulanWinVariable
					value = 5
				}
			}
		}
		unit_owner = {
			country_event = { id = majapahit.2 days = 2 }
		}
	}
	if = {
		limit = {
			unit_owner = {
				mission_completed = son_military_expertise
				NOT = { mission_completed = son_win_battles }
			}
		}
		unit_owner = {
			change_variable = {
				which = son_fight_counter
				value = 1
			}
		}
		if = {
			limit = {
				is_ruler_commanding_unit = yes
			}
			unit_owner = {
				change_variable = {
					which = son_fight_counter
					value = 1
				}
			}
		}
	}
	if = {
		limit = {
			unit_owner = {
				has_government_attribute = winning_battles_increases_legitimacy
			}
			is_ruler_commanding_unit = yes
		}
		unit_owner = {
			add_legitimacy = 0.5
			add_devotion = 0.5
			add_republican_tradition = 0.1
			add_revolutionary_zeal_or_absolutism = { amount = 0.1 }
		}
	}
	if = {
		limit = {
			general_with_name = "Jean Bureau"
		}
		unit_owner = {
			change_variable = {
				which = jean_bureau_battles_won 
				value = 1
			}
		}
	}
	
	#ME Stuff
	if = {
		limit = {
			template = me_tim_war_elephants
		}
		unit_owner = {
			change_variable = {
				which = METimElephantBattlesWon
				value = 1
			}
		}
	}
	if = {
		limit = {
			general_with_name = "Pir Budaq"
			unit_owner = {
				has_country_flag = QAR_pir_budaq_10_battles
			}
		}
		unit_owner = {
			change_variable = {
				which = QAR_pir_budaq_10_battles 
				value = 1
			}
		}
	}
	if = {
		limit = {
			general_with_name = "Pir Budaq"
			unit_owner = {
				has_country_flag = QAR_pir_budaq_10_battles
			}
			unit_owner = {
				check_variable = {
					which = QAR_pir_budaq_10_battles
					value = 10
				}
			}
		}
		unit_owner = {
			clr_country_flag = QAR_pir_budaq_10_battles
			set_variable = {
				which = QAR_pir_budaq_10_battles
				value = 0
			}
			country_event = { id = ME_Qara_Qoyunlu_Events.27 days = 2 }
		}
	}
	if = {
        limit = {
            unit_owner = {
                has_country_flag = ME_tim_battle_tendency_mission_flag
            }
            is_ruler_commanding_unit = yes
        }
        unit_owner = {
            add_estate_loyalty = {
				estate = estate_nomadic_tribes
				loyalty = 5
			}
        }
    }

	if = {
        limit = {
            unit_owner = {
                has_country_flag = me_tim_ruler_victories_give_reform_progress
            }
            is_ruler_commanding_unit = yes
        }
        unit_owner = {
            change_government_reform_progress = 1
        }
    }
}
# THIS = Province, FROM = Country, ROOT = Merc Unit
on_mercenary_recruited = {
	on_mercenary_recruited_effect = yes
}

on_culture_promoted = {
	if = {
		limit = {
			has_government_mechanic = habsburg_glory
		}
		HAB_change_habsburg_glory = { amount = 5 }
	}
	
	on_culture_promoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_culture_country_effect = yes
	
	if = { 
		limit = { has_country_flag = reduce_ae_from_prom_cultures_flag }
		every_country = {
			add_aggressive_expansion = {
				who = ROOT 
				value = -3
				apply_calc = no 
			}
		}
	}
}

on_culture_demoted = {
	if = {
		limit = {
			has_government_mechanic = habsburg_glory
		}
		HAB_change_habsburg_glory = { amount = -7 }
	}
	on_culture_demoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_culture_country_effect = yes
	on_culture_demoted_effect = yes
}

on_weak_heir_claim = {
	if = {
		limit = {
			has_government_mechanic = habsburg_glory
		}
		HAB_change_habsburg_glory = { amount = -5 }
	}
	events = {
		611		# Pretenders rise up
	}
}

on_successive_emperor  = {
	if = {
		limit = {
			has_government_mechanic = habsburg_glory
		}
		HAB_change_habsburg_glory = { amount = 2 }
	}
	emperor = {
		save_global_event_target_as = Emperor
	}
	events = {
		900
	}
}

#on_four_year_pulse_4 = {
#	random_events = {
#		# Board of Personnel chain
#		100 = ME_Manchu_Events.17
#		100 = ME_Manchu_Events.18
#		100 = ME_Manchu_Events.19
#
#		# Bourd of Revenue chain
#		100 = ME_Manchu_Events.21
#		100 = ME_Manchu_Events.22
#		100 = ME_Manchu_Events.23
#	}
#}

on_golden_bull_enacted = {
	set_country_flag = enacted_golden_bull
	
	if = {
		limit = { 
			FRA = { has_country_flag = fu_gain_25_random_pp_and_10_pi_per_bull_flag } 
		}
		FRA = {
			random_list = {
				10 = { add_adm_power = 25 }
				10 = { add_dip_power = 25 }
				10 = { add_mil_power = 25 }
			}
			add_papal_influence = 10 
		}
	}
	
	#ME Stuff
	if = {
		limit = {
			has_country_flag = me_pi_from_bulls
		}
		add_papal_influence = 30
	}
}

on_battle_lost_unit = {
    on_battle_lost_unit_effect = yes
    if = {
        limit = {
            unit_owner = {
                tag = MNG
                has_ruler_flag = mng_militry_incompetence
            }
            is_ruler_commanding_unit = yes
			enemy_unit = {
				unit_owner = {
					tag = OIR
				}
			}
        }
        OIR = {
            country_event = { id = flavor_oir.2 }
        }
    }
	
	if = {
		limit = {
			unit_owner = {
				tag = BUR
			}
			enemy_unit = {
				unit_owner = {
					has_country_flag = me_bur_beating_bur_king_in_battle
				}
			}
		}
		unit_owner = {
			random = { 
				chance = 10
				
				country_event = { id = incidents_bur_inheritance.1 }
			}
		}
	}
}

on_general_recruited = {
	on_general_recruited_effect = yes
	
	if = {
		limit = {
			has_country_modifier = me_hab_general_staff
		}
		add_army_tradition = 2
		if = {
			limit = {
				num_of_generals = 10
				NOT = { has_country_modifier = me_hab_staff_planning }
			}
			add_country_modifier = {
				name = me_hab_staff_planning
				duration = -1
			}
		}
	}
	
	if = {
		limit = { has_government_attribute = recruiting_generals_increases_nobles_loyalty }
		if = {
			limit = {
				has_estate = estate_nobles
			}
			add_estate_loyalty = {
				estate = estate_nobles
				loyalty = 2
			}
		}
		if = {
			limit = {
				has_estate = estate_maratha
			}
			add_estate_loyalty = {
				estate = estate_maratha
				loyalty = 2
			}
		}
		if = {
			limit = {
				has_estate = estate_rajput
			}
			add_estate_loyalty = {
				estate = estate_rajput
				loyalty = 2
			}
		}
	}

	if = {
		limit = {
			mission_completed = ME_tim_military_loyalty
		}
		add_army_professionalism = 0.01
	}
}

# province:  spawned whenever a new owner takes over the province
# FROM = The previous owner.
on_conquest = {
	remove_named_unrest = estate_land_seized
	clr_province_flag = has_estate_unrest_flag
	if = {
		limit = { 
			is_part_of_hre = no
			owner = { 
				has_country_flag = pru_dom_hre_flag 
				alliance_with = emperor 
			}
		}
		owner = {
			add_trust = {
				who = emperor 
				value = 3 
				mutual = yes 
			}
		}
	}
	else_if = {
		limit = { 
			is_part_of_hre = no
			owner = { 
				has_country_flag = pru_dom_hre_flag 
				NOT = { alliance_with = emperor } 
			}
		}
		owner = {
			add_power_projection = {
				type = mission_rewards_power_projection
				amount = 1
			}
		}
	}
	else_if = {
		limit = { 
			is_part_of_hre = no
			owner = { is_emperor = yes }
		}
		owner = { 
			add_imperial_influence = 0.5
		}
	}
	
	#ME Stuff
	
	if = {
		limit = {
			owner = { has_country_flag = me_hab_venetian_modifier }
		}
		if = {
			limit = {
				venetia_area = {
					type = all
					owned_by = ROOT
				}
			}
			owner = {
				add_country_modifier = {
					name = me_hab_venetian_sailors
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					venetia_area = {
						type = all
						owned_by = ROOT
					}
				}
			}
			FROM = {
				remove_country_modifier = me_hab_venetian_sailors
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				NOT = { has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces }
			}
			has_province_modifier = me_hab_development_law
		}
		remove_province_modifier = me_hab_development_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			NOT = { has_province_modifier = me_hab_development_law }
		}
		add_province_modifier = {
			name = me_hab_development_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		owner = {
			add_disaster_progress = {
				disaster = ME_the_end_of_times
				value = -0.3
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				NOT = { has_country_flag = me_hab_conscription_on_foreign_provinces }
			}
			has_province_modifier = me_hab_conscription_law
		}
		remove_province_modifier = me_hab_conscription_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			NOT = { has_province_modifier = me_hab_conscription_law }
		}
		add_province_modifier = {
			name = me_hab_conscription_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			FROM = {
				has_country_modifier = me_hab_iberian_ties
				has_country_flag = me_hab_iberian_ties_flag
			}
			NOT = {
				iberia_region = {
					type = all
					country_or_non_sovereign_subject_holds = ROOT
				}
			}
		}
		remove_country_modifier = me_hab_iberian_ties
	}
	else_if = {
		limit = {
			FROM = {
				has_country_flag = me_hab_iberian_ties_flag
				NOT = { has_country_modifier = me_hab_iberian_ties }
			}
			iberia_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		add_country_modifier = {
			name = me_hab_iberian_hegemony
			duration = -1
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_horde_path
			}
		}
		owner = {
			change_variable = {
				which = METimConquestHorde
				value = 1
			}
		}
	}

	if = {
		limit = {
			owner = {
				has_country_modifier = ME_tim_horsemen_of_apocalypse_modifier
			}
			development = 3
		}
		add_base_tax = 1
	}
}

# country
# root = winning country, from = loser country
on_war_won = {
	FROM = { country_event = { id = flavor_cri.6 } }
	ROOT = { country_event = { id = tributary_events.32 } }
	if = {
		limit = {
			has_country_flag = can_gain_legendary_pirates_flag
			NOT = { has_ruler_flag = historical_pirate }
			has_government_attribute = is_pirate_republic_reform
			FROM = { total_development = ROOT }
		}
		random = {
			chance = 5
			country_event = {
				id = pirates.25
			}
		}
	}
	
	if = {
		limit = {
			is_part_of_hre = yes
			FROM  = { is_part_of_hre = yes }
		}
		ROOT = { save_global_event_target_as = hre_winner }
		FROM = { save_global_event_target_as = hre_loser }
		random_known_country = {
			limit = {
				has_reform = free_city
				NOT = {
					prestige = 40
				}
				NOT = {
					has_country_modifier = fc_treatyconference_timer
				}
			}
			add_country_modifier = {
				name = fc_treatyconference_timer
				duration = 3650
				hidden = yes
			}
			country_event = {
				id = free_cities.7
				days = 7
			}
		}
	}

	if = {
		limit = {
			tag = MLO
			NOT = { has_country_flag = emp_mlo_won_war_with_swiss_mercs }
			any_hired_mercenary_company = {
				home_province = {
					OR = {
						area = switzerland_area
						area = romandie_area
					}
				}
			}
		}
		set_country_flag = emp_mlo_won_war_with_swiss_mercs
	}
	
	if = {
		limit = {
			is_hiring_condottiere_from = SWI
		}
		SWI = { set_country_flag = won_condottiere_war }
		if = {
			limit = {
				tag = PAP
			}
			SWI = {
				set_country_flag = hired_to_pope
			}
		}
	}
	
	if = {
		limit = {
			primary_culture = melanesian
			NOT = { has_country_modifier = warlord_mod }
		}
		FROM = {
			country_event = {
				id = polynesian.17
			}
		}
	}
	if = {
		limit = {
			ROOT = { 
				tag = SWE
				has_country_modifier = swe_vasa_leads_the_rebellion
				is_subject = no
			}
			FROM = { tag = DAN }
		}
		country_event = {
			id = flavor_swe.111
		}
	}
	if = {
		limit = {
			ROOT = { 
				tag = SWE
				has_country_modifier = swe_any_vasa_leads_the_rebellion
				is_subject = no
			}
			FROM = { tag = DAN }
		}
		country_event = {
			id = flavor_swe.105
		}
	}
	if = {
		limit = {
			ROOT = { 
				tag = SWE
				has_country_flag = swe_declared_independence_war
				is_subject = no
			}
			FROM = { tag = DAN }
		}
		country_event = {
			id = flavor_swe.121
		}
	}

	#ME Stuff
	if = {
		limit = {
			has_country_modifier = me_tim_stampede_the_traitor 
			NOT = {
				war_with = QOM
			}
		}
		remove_country_modifier = me_tim_stampede_the_traitor
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					OR = {
						area = lower_swabia_area
						area = upper_swabia_area
					}
				}
			}
		}
		FROM = {
			set_country_flag = me_hab_beaten_by_habsburgs
		}
		change_variable = {
			which = meBeatSwabians
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_von_haugwitz_reforms
		}
		change_variable = {
			which = MEHABWarsWon
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_tim_win_wars
		}
		change_variable = {
			which = METimWonWars
			value = 1
		}
	}
	
	if = {
		limit = {
			mission_completed = TIM_army_reforms
		}
		change_variable = {
			which = METimWarsWon1
			value = 1
		}
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					continent = europe
				}
			}
		}
		change_variable = {
			which = me_tim_europe_victory
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_von_haugwitz_reforms
			is_at_war = no
		}
		remove_country_modifier = me_hab_wartime_army
		add_country_modifier = {
			name = me_hab_peacetime_army
			duration = -1
			desc = me_as_long_as_we_are_at_peace
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_hofkriegstrat_flag
			is_at_war = no
		}
		remove_country_modifier = me_hab_war_council
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					is_part_of_hre = no
				}
			}
		}
		change_variable = {
			which = MEHabBeatenEnemies
			value = 1
		}
	}
	if = {
		limit = {
			FROM = {
				NOT = { religion = ROOT }
			}
		}
		change_variable = {
			which = ME_num_of_heathen_heretic_wars_won
			value = 1
		}
	}
		
	
	if = {
		limit = {
			has_global_flag = imperial_treasurer_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_treasurer
				}
			}
		}
		clr_global_flag = imperial_treasurer_established
	}
	
	if = {
		limit = {
			has_global_flag = imperial_marshall_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_marshall
				}
			}
		}
		clr_global_flag = imperial_marshall_established
	}
	
	if = {
		limit = {
			has_global_flag = imperial_court_chaplain_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_court_chaplain
				}
			}
		}
		clr_global_flag = imperial_court_chaplain_established
	}
	
	if = {
		limit = {
			NOT = { has_country_flag = me_hab_won_against_swiss }
			tag = HAB
			FROM = {
				tag = SWI
			}
		}
		set_country_flag = me_hab_won_against_swiss
	}
	
	if = {
		limit = {
			tag = TUN
			FROM = {
				has_country_flag = TUN_abu_l_hasan
				ai = yes 
			}
		}
		add_yearly_manpower = 1.5
		FROM = {
			every_owned_province = {
				random_core_country = {
					every_core_province = {
						limit = {
							owned_by = FROM
						}
						cede_province = PREV
					}
				}
			}
			random_neighbor_country = {
				limit = {
					ai = yes
				}
				save_event_target_as = TUN_annex_us
			}
			if = {
				limit = {
					has_saved_event_target = TUN_annex_us
				}
				every_owned_province = {
					add_core = ROOT
					cede_province = event_target:TUN_annex_us
				}
			}
		}
	}
	else_if = {
		limit = {
			has_country_flag = TUN_abu_l_hasan
			FROM = {
				tag = TUN
				ai = yes 
			}
		}
		if = {
			limit = {
				NOT = { exists = TRP }
			}
			FROM = { change_tag = TRP }
		}
		remove_country_modifier = TUN_abu_l_hasans_rebellion_modifier
	}
	else = { }
	
	if = {
		limit = {
			has_global_flag = GHD_some_nation_set_west_africa_on_fire
			technology_group = sub_saharan 
			FROM = {
				technology_group = sub_saharan 
			}
		}
		every_country = {
			# every_trade_node_member_country = {
			limit = {
				has_country_flag = GHD_nations_in_west_africa_fighting_wars_buff_us
				NOT = { tag = FROM }
				NOT = { tag = ROOT }
				OR = {
					1132 = {
						has_merchant = PREV
					}
					1149 = {
						has_merchant = PREV
					}
				}
			}
			export_to_variable = {
				variable_name = ROOT_dev
				value = total_development
				who = ROOT
			}
			export_to_variable = {
				variable_name = PREV_dev
				value = total_development
				who = PREV
			}
			change_variable = {
				which = ROOT_dev
				which = PREV_dev
			}
			while = {
				limit = {
					check_variable = {
						which = ROOT_dev
						value = 1
					}
				}
				subtract_variable = {
					which = ROOT_dev
					value = 1
				}
				add_treasury = 1
				add_manpower = 0.025
			}
			set_variable = {
				which = ROOT_dev
				value = 0
			}
			set_variable = {
				which = PREV_dev
				value = 0
			}
		}
	}
	if = {
		limit = {
			has_global_flag = YEM_relationship
			has_saved_global_event_target = YEM_target
			has_saved_global_event_target = YEM_beneficiary
		}
		if = {
			limit = {
				tag = event_target:YEM_target
			}
			event_target:YEM_beneficiary = {
				add_dip_power = 50
				add_mil_power = 50
			}
		}
	}
	
	if = {
		limit = {
			has_country_modifier = MSY_the_end_is_nigh
			FROM = { 
				NOT = { religion = ROOT }
			}
		}
		add_disaster_progress = {
			disaster = ME_the_end_of_times
			value = -2.5
		}
	}
	
	if = {
		limit = {
			has_reform = timurid_prince
			any_country = {
				dynasty = ROOT
				is_subject_of = ROOT
				has_opinion_modifier = {
					who = ROOT
					modifier = TIM_sibling_rivalry
				}
			}
		}
		every_known_country = {
			limit = {
				dynasty = ROOT
				is_subject_of = ROOT
				has_opinion_modifier = {
					who = ROOT
					modifier = TIM_sibling_rivalry
				}
			}
			remove_opinion = {
				who = ROOT
				modifier = TIM_sibling_rivalry
			}
			reverse_remove_opinion = {
				who = ROOT
				modifier = TIM_sibling_rivalry
			}
		}
	}
	
	if = {
		limit = {
			tag = TIM
			has_country_flag = me_tim_flight_to_india
			any_owned_province = {
				superregion = india_superregion
			}
		}
		country_event = { id = ME_Timurid_Succession_Crisis_Events.10 }
	}
	
	if = {
		limit = {
			tag = AFG
			is_subject = no
			NOT = { has_country_flag = me_afg_babur_arrival }
		}
		set_country_flag = me_afg_babur_arrival
		country_event = { id = ME_Timurid_Princes_Event.26 days = 32 }
	}
	
	if = {
		limit = {
			has_country_flag = me_tim_win_wars
		}
		change_variable = {
			which = METimWonWars
			value = 1
		}
	}

	if = {
		limit = {
			NOT = {
				exists = TIM
			}
			any_province = {
				has_province_flag = me_tim_wasteland
			}
		}
		every_province = {
			limit = {
				has_province_flag = me_tim_wasteland
			}
			clr_province_flag = me_tim_wasteland
		}
	}
}

on_force_conversion = {
	on_force_conversion_effect = yes
	
	if = {
		limit = {
			FROM = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		FROM = {
			add_disaster_progress = {
				disaster = ME_the_end_of_times
				value = -2.5
			}
		}
	}
	
	if = {
		limit = {
			technology_group = western
			FROM = {
				has_country_flag = ARB_islamization_of_europe_cb
			}
		}
		add_power_projection = {
			type = ARB_islamization_of_europe
			amount = 5
		}
	}
	
	if = {
		limit = {
			FROM = { has_country_flag = RUM_conversion }
		}
		FROM = { add_adm_power = 50 }
	}
}

on_startup = {
	if = {
		limit = {
			current_age = age_of_discovery
		}
		LXA = {
			if = {
				limit = {
					NOT = { has_country_flag = lxa_loyalty_flag }
				}
				add_estate_loyalty = {
					estate = estate_church
					loyalty = -10
				}
				set_country_flag = lxa_loyalty_flag
			}
		}
	}
	emperor = {
		save_global_event_target_as = Emperor
	}
	if = {
		limit = {
			is_emperor_of_china = yes
		}
		save_global_event_target_as = EmperorOfChina
	}
	events = {
		muslim_school_events.20 #Pick School
		flavor_got.1 #Event for Gotland to select their mission tree
		flavor_mng.42 #Event for the starting situation of the Ming 
		#flavor_fra.15000 #Make the French Revolution happen if starting in 1789
		flavor_mos.1 #Event regarding the Tatar Yoke
		ME_Qara_Qoyunlu_Events.10
        missions_expanded_events.5
	}
	if = {
		limit = {
			has_dlc = "Cradle of Civilization"
			has_country_modifier = tur_janissary
		}
		remove_country_modifier = tur_janissary
	}
	initialize_schools_effect = yes #This is only used here but is used for readability of on_action file.

	if = {
		limit = {
			NOT = { has_country_flag = new_flavour_bav_13_has_been_triggered }
			OR = {
				tag = UBV
				tag = LBV
				tag = ING
			}
		}
		set_country_flag = new_flavour_bav_13_has_been_triggered
		country_event = { id = new_flavour_bav.13 days = 90 } #better not to allow almost instant DOWs
	}
	if = {
		limit = {
			tag = FRA
			started_in = 1789.7.14
			NOT = { is_year = 1790 }
			NOT = { has_disaster = french_revolution }
		}
		add_disaster_progress = {
			value = 100
			disaster = french_revolution
		}
	}
	if = {
		limit = {
			exists = SUK
		}
		SUK = {
			set_ruler_flag = suk_monarch_flag
		}
		AYU = {
			set_country_flag = ayu_monarch_flag
		}
	}
	#if = {
	#	limit = {
	#		OR = {
	#			primary_culture = norse
	#			AND = {
	#				culture_group = scandinavian
	#				religion = norse_pagan_reformed
	#			}
	#		}
	#		NOT = { has_idea_group = norse_ideas }
	#		is_playing_custom_nation = no
	#	}
	#	country_event = { id = ideagroups.1 } #Swap Ideas
	#}
	if = {
		limit = { 
			has_dlc = "Domination" 
			tag = FRA 
			NOT = { is_year = 1445 } 
		}
		country_event = { id = flavor_fra.206 }
	}
	if = {
		limit = {
			NOT = { has_global_flag = end_of_the_tatar_yoke }
			owns = 466
			is_year = 1480
		}
		set_global_flag = end_of_the_tatar_yoke
	}
	if = {
		limit = {
			OR = {
				has_country_modifier = rise_of_the_ottomans
				has_country_modifier = zenith_of_the_ottomans
				has_country_modifier = twilight_of_the_ottomans
				has_country_modifier = decline_of_the_ottomans
			}
		}
		remove_country_modifier = rise_of_the_ottomans
		remove_country_modifier = zenith_of_the_ottomans
		remove_country_modifier = twilight_of_the_ottomans
		remove_country_modifier = decline_of_the_ottomans
	}
	if = {
		limit = {
			has_government_mechanic = ottoman_decadence_mechanic
			current_age = age_of_discovery
		}
		add_country_modifier = {
			name = rise_of_the_ottomans
			duration = -1
			desc = until_end_of_age_desc
		}
	}
	if = {
		limit = {
			has_government_mechanic = ottoman_decadence_mechanic
			current_age = age_of_reformation
		}
		add_country_modifier = {
			name = zenith_of_the_ottomans
			duration = -1
			desc = until_end_of_age_desc
		}
	}
	if = {
		limit = {
			has_government_mechanic = ottoman_decadence_mechanic
			current_age = age_of_absolutism
		}
		add_country_modifier = {
			name = twilight_of_the_ottomans
			duration = -1
			desc = until_end_of_age_desc
		}
	}
	if = {
		limit = {
			has_government_mechanic = ottoman_decadence_mechanic
			current_age = age_of_revolutions
		}
		add_country_modifier = {
			name = decline_of_the_ottomans
			duration = -1
			desc = until_end_of_age_desc
		}
	}
	
	361 = { 
		province_event = { id = ME_Abbasid_Events.1 }
	}
	run_on_startup_compatability_effects = yes
	riverupdate = yes
	update_monuments_self = yes
}

on_add_pasha = {
	if = {
		limit = {
			event_target:province_owner = {
				has_country_flag = tur_improved_pashas
			}
		}
		area = {
			limit = { owned_by = event_target:province_owner NOT = { culture_group = event_target:province_owner } }
			add_province_modifier = { name = tur_competent_pashas duration = -1 }
		}
	}
	if = {
		limit = {
			event_target:province_owner = {
				has_government_attribute = pasha_extra_bonuses
			}
		}
		area = {
			limit = { owned_by = event_target:province_owner NOT = { culture_group = event_target:province_owner } }
			add_province_modifier = { name = the_provincial_system duration = -1 }
		}
	}
	
	#ME Stuff
	
	if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_empowerment
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_modifier
				duration = -1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_seljuk_flag
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_seljuk_modifier
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_roman_flag
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_roman_modifier
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_caliphate_modifier
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			#add_province_modifier = { @stiopa to fix this
			#	name = RUM_pasha_caliphate_flag 
			#	duration = -1
			#}
		}
	}
	else = { }
}

# THIS = One province in the state
on_remove_pasha = {
	hidden_effect = {
		owner = {
			save_event_target_as = province_owner
		}
	}

	area = {
		limit = { owned_by = event_target:province_owner }
		add_or_extend_province_modifier_effect = { MODIFIER = pasha_removed_modifier DURATION = 3650 }
		if = {
			limit = { has_province_modifier = tur_competent_pashas }
			remove_province_modifier = tur_competent_pashas
		}
		if = {
			limit = { has_province_modifier = the_provincial_system }
			remove_province_modifier = the_provincial_system
		}
	}

	area = {
		limit = { owned_by = event_target:province_owner }
		add_or_extend_province_modifier_effect = { MODIFIER = pasha_removed_modifier DURATION = 3650 }
		remove_province_modifier = RUM_pasha_modifier
		remove_province_modifier = RUM_pasha_seljuk_modifier
		remove_province_modifier = RUM_pasha_roman_modifier
		remove_province_modifier = RUM_pasha_caliphate_modifier
	}
}

on_janissaries_raised = {
	owner = {
		if = {
			limit = {
				has_country_flag = RUM_cost_of_janissaries_decreased
			}
			add_mil_power = 6
		}
	}
}

#on_four_year_pulse_4 = {
#	random_events = {
#		# Board of Personnel chain
#		100 = ME_Manchu_Events.17
#		100 = ME_Manchu_Events.18
#		100 = ME_Manchu_Events.19
#
#		# Bourd of Revenue chain
#		100 = ME_Manchu_Events.21
#		100 = ME_Manchu_Events.22
#		100 = ME_Manchu_Events.23
#	}
#}

# country
# root = winning country, from = location
on_siege_won_country = {
	if = {
		limit = {
			from = { owned_by = SAX }
			OR = {
				is_in_war = {
					defenders = root
					defenders = THU
					defenders = emperor
					attackers = SAX
				}
				is_in_war = {
					attackers = root
					attackers = THU
					attackers = emperor
					defenders = SAX
				}
			}
			THU = {
				dynasty = "von Wettin"
				is_elector = no
				is_emperor = no
				alliance_with = emperor
			}
			SAX = {
				is_elector = yes
				all_owned_province = {
					NOT = { controlled_by = SAX }
					OR = {
						controlled_by = THU
						controller = {
							OR = {
								is_in_war = {
									defenders = this
									defenders = THU
									defenders = emperor
									attackers = SAX
								}
								is_in_war = {
									attackers = this
									attackers = THU
									attackers = emperor
									defenders = SAX
								}
							}
						}
					}
				}
			}
		}
		THU = { country_event = { id = flavor_sax.10 } } # Ask Emperor for Saxon Electorate
	}
	if = {
		limit = {
			ROOT = {
				religion = jewish
				has_church_aspect = judaism_remember_passover_aspect
			}
			FROM = {
				owner = {
					war_with = ROOT
				}
				fort_level = 1
			}
		}
		ROOT = {
			add_church_power = 5
		}
	}
	grant_manpower_from_besieging_fort = yes
	events = {
		tyw_events.14 # Fall of Prague in Religious War
		flavor_oir.5 # Oirats capture Beijing
		flavor_lna.1 # Emerald Buddha
		flavor_son.14 # Djenne surrenders to Songhai Trigger
		flavor_teu.25 # Payback for the Hussite Wars
		flavor_tur.240 # Collapse of teh Mamluks
		flavor_kor.16 # Tripitaka Koreana
		flavor_tur.211 # Fall of Vienna
	}
	random_events = {
		10 = army_professionalism_events.1 #City Sacked
		100 = 0
	}
	
	if = {
		limit = {
			FROM = {
				OR = {
					region = malaya_region
					region = indonesia_region
				}
				controller = {
					has_country_flag = me_mug_expedition_start
				}
			}
		}
		FROM = {
			save_global_event_target_as = expedition_spawn
		}
		country_event = { id = ME_Mughal_Events.25 }
		clr_country_flag = me_mug_expedition_start
	}
	
	#Hindu Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_hindustan_focus
			FROM = {
				province_id = 522
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_hindu_subah
		add_ruler_modifier = {
			name = me_mug_hindu_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_hindustan_focus
			FROM = {
				province_id = 522
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_hindu_subah_negative
		add_ruler_modifier = {
			name = me_mug_hindu_subah
			duration = -1
		}
	}
	
	#Bengal Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_bengal_focus
			FROM = {
				province_id = 563
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_bengal_subah
		add_ruler_modifier = {
			name = me_mug_bengal_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_bengal_focus
			FROM = {
				province_id = 563
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_bengal_subah_negative
		add_ruler_modifier = {
			name = me_mug_bengal_subah
			duration = -1
		}
	}
	
	#Rajput Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_rajput_focus
			FROM = {
				province_id = 2087
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_rajput_subah
		add_ruler_modifier = {
			name = me_mug_rajput_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_rajput_focus
			FROM = {
				province_id = 2087
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_rajput_subah_negative
		add_ruler_modifier = {
			name = me_mug_rajput_subah
			duration = -1
		}
	}
	
	#Gujarat Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_gujarat_focus
			FROM = {
				province_id = 2054
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_gujarat_subah
		add_ruler_modifier = {
			name = me_mug_gujarat_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_gujarat_focus
			FROM = {
				province_id = 2054
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_gujarat_subah_negative
		add_ruler_modifier = {
			name = me_mug_gujarat_subah
			duration = -1
		}
	}
	
	#Malwa Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 526
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_malwa_subah_bonus
		add_ruler_modifier = {
			name = me_mug_malwa_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 526
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_malwa_subah_negative
		add_ruler_modifier = {
			name = me_mug_malwa_subah_bonus
			duration = -1
		}
	}
	
	#Deccan Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_deccan_focus
			FROM = {
				province_id = 541
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_deccan_subah_bonus
		add_ruler_modifier = {
			name = me_mug_deccan_subah_bonus_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 541
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_deccan_subah_bonus_negative
		add_ruler_modifier = {
			name = me_mug_deccan_subah_bonus
			duration = -1
		}
	}

	if = {
		limit = {
			from = { fort_level = 1 }
		}
		change_variable = {
			which = num_of_sieges_won
			value = 1
		}
	}
}

on_siege_won_province = {
	events = {
		fcsp_events.1
		synthetic_dawn.4
	}
	if = {
		limit = {
			from = {
				tag = REB
				is_rebel_type = revolutionary_rebels
			}
			owner = {
				any_owned_province = {
					region = root
					has_revolution_in_province = yes
				}
				NOT = { has_disaster = french_revolution }
				NOT = { has_disaster = revolution }
				NOT = { has_spawned_rebels = revolutionary_rebels }
			}
		}
		owner = { country_event = { id = center_of_revolution.1600 } }
	}
	if = {
		limit = {
			superregion = china_superregion
			controller = {
				has_government_attribute = has_unify_china_cb
				OR = {
					is_in_war = {
						attacker_leader = this
						casus_belli = cb_chinese_unification
					}
					is_in_war = {
						defender_leader = this
						casus_belli = cb_chinese_unification
					}
				}
				NOT = { is_core = ROOT }
			}
		}
		controller = { 
			add_territorial_core = ROOT
			if = {
				limit = { is_claim = ROOT}
				remove_claim = ROOT
			}
		}
	}
	
	#ME Stuff
	
	if = {
		limit = {
			culture = andalucian
			controller = {
				capital_scope = {
					region = maghreb_region
				}
				is_in_war = {
					casus_belli = cb_oran_fatwa
				}
			}
			from = {
				religion_group = christian
			}
		}
		controller = {
			ROOT = { save_event_target_as = Tunis_the_province }
			country_event = { id = ME_Tunis_Events.13 }
		}
	}
}

on_siege_lost_province = {
	events = {
		fcsp_events.1
		war_of_the_roses.10		# Lancaster Stronghold
		war_of_the_roses.11		# York Stronghold
		french_wars_of_religion.7 #Ravening Religious Fanatics
		french_wars_of_religion.9 #french_wars_of_religion.9
	}
}

on_capital_moved = {
	if = {
		limit = {
			has_country_modifier = me_mug_capital_of_agra
			524 = {
				has_province_modifier = me_mug_capital_city
			}
			NOT = { capital = 524 }
		}
		remove_country_modifier = me_mug_capital_of_agra
		524 = {
			remove_province_modifier = me_mug_capital_city
		}
	}
	else_if = {
		limit = {
			has_country_flag = me_mug_agra_capital_bonuses
			NOT = { has_country_modifier = me_mug_capital_of_agra }
			524 = {
				NOT = { has_province_modifier = me_mug_capital_city }
			}
			capital = 524
		}
		add_country_modifier = {
			name = me_mug_capital_of_agra
			duration = -1
		}
		524 = {
			add_province_modifier = {
				name = me_mug_capital_city
				duration = -1
			}
		}
	}
}

on_four_year_pulse_3 = { #for our nobles
	random_events = {
		1500 = 0
		100 = me_austria_nobles.2
		100 = me_austria_nobles.3
		750 = decadence.1
		750 = decadence.2
		750 = decadence.3
		750 = decadence.4
		750 = decadence.5
		750 = decadence.6
		750 = decadence.7
		750 = decadence.8
		750 = decadence.9
		750 = decadence.10
	}
}

# province
on_province_religion_converted = {
	on_province_religion_changed_effect = yes
	on_province_religion_converted_effect = yes
	
	#ME Stuff
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_court_chaplain
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = ME_muslim_enforced_religion
			}
			# religion_group = owner 
			# NOT = { religion = owner }
		}
		export_to_variable = {
			which = ME_temp_religion_enforced
			value = trigger_value:development
		}
		while = {
			limit = {
				check_variable = {
					which = ME_temp_religion_enforced
					value = 1
				}
			}
			owner = {
				add_piety = 0.02
			}
			change_variable = {
				which = ME_temp_religion_enforced
				value = -1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		export_to_variable = {
			which = MSY_temp
			value = trigger_value:development
		}
		while = {
			limit = {
				check_variable = {
					which = MSY_temp
					value = 1
				}
			}
			owner = {
				add_disaster_progress = {
					disaster = ME_the_end_of_times
					value = -0.2
				}
			}
			change_variable = {
				which = MSY_temp
				value = -1
			}
		}
	}
	
	# if = {
		# limit = {
			# owner = {
				# has_country_flag = RUM_piety_from_conversion
			# }
		# }
		# export_to_variable = {
			# which = MSY_temp
			# value = trigger_value:development
		# }
		# while = {
			# limit = {
				# check_variable = {
					# which = MSY_temp
					# value = 1
				# }
			# }
			# owner = {
				# add_positive_or_negative_piety = { amount = 0.2 }
			# }
			# change_variable = {
				# which = MSY_temp
				# value = -1
			# }
		# }
	# }

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_reduced_conversion_on_razing
			}
		}
		remove_province_modifier = religious_zeal_at_conv
		add_province_modifier = {
			name = me_tim_harsh_conversions
			duration = 7300
		}
	}
}

# ROOT = Overlord, FROM = Minor
on_dependency_lost = {
	if = {
		limit = {
			has_country_modifier = mng_tibetan_horses_monopoly_modifier
		}
		remove_country_modifier = mng_tibetan_horses_monopoly_modifier
	}
	if = {
		limit = {
			has_country_modifier = tur_tatar_vanguard_modifier
			FROM = { tag = CRI }
		}
		remove_country_modifier = tur_tatar_vanguard_modifier
	}
	if = {
		limit = {
			has_country_modifier = rus_grand_duke_of_finland
			FROM = { tag = FIN }
		}
		remove_country_modifier = rus_grand_duke_of_finland
	}
	FROM = {
		if = {
			limit = { has_country_modifier = revoked_war_rights }
			remove_country_modifier = revoked_war_rights
		}
	}
	
	#ME Stuff
	if = { 
        limit = { 
            AND = {
                ROOT = { has_country_modifier = me_hab_imperial_march }
                FROM = { has_country_modifier = me_bra_new_march }
            }
        }
        FROM = { remove_country_modifier = me_bra_new_march }
        ROOT = { remove_country_modifier = me_hab_imperial_march }
    }
	if = {
		limit = {
			FROM = {
				OR = {
					tag = HUN
					tag = BOH
				}
			}
			ROOT = {
				tag = HAB
			}
		}
		FROM = { 
			restore_country_color = yes
			clr_country_flag = has_overriden_color_flag		 
		}

	}
	FROM = { set_country_flag = dependencylost }
	ROOT = { set_country_flag = dependencylost }
	update_monuments_self = yes
	FROM = { clr_country_flag = dependencylost }
	ROOT = { clr_country_flag = dependencylost }
	run_on_dependency_lost_compatability_effects = yes
}

on_center_of_trade_upgrade = {
	if = {
		limit = { owner = { has_country_flag = enable_upgrading_centers_of_trade_dev } }
		add_base_production = 1 
	}
	
	#ME Stuff
	if = { 
		limit = { 
			owner = { has_country_flag = tur_built_sari_markets } 
		}
		add_base_production = 1
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_cot_bonus
			}
		}
		add_base_production = 2
	}
}

on_center_of_trade_downgrade = {
	if = {
		limit = { owner = { has_country_flag = enable_upgrading_centers_of_trade_dev } }
		add_base_production = -1 
	}
	
	#ME Stuff
	if = { 
		limit = { 
			owner = { has_country_flag = tur_built_sari_markets } 
		}
		add_base_production = -1
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_cot_bonus
			}
		}
		add_base_production = -2
	}
}

on_parliament_debate_succeeded = {
	increase_issue_passed_counter = yes
	if = { 
		limit = { 
			has_country_flag = issue_grants_25_random_pp_flag
		}
		random_list = { 
			33 = { add_adm_power = 25 } 
			34 = { add_dip_power = 25 } 
			33 = { add_mil_power = 25 } 
		}
	}
}

on_extend_regency = {
	if = { 
		limit = { has_country_flag = tur_reign_of_women_era_flag } 
		add_legitimacy = 10 
		random_list = { 
			30 = { 
				change_adm = 1 
				add_adm_power = 50 
			} 
			40 = { 
				change_dip = 1 
				add_dip_power = 50 
			}
			30 = { 
				change_mil = 1 
				add_mil_power = 50 
			}
		}
	}
}

# province
# FROM = old owner
on_province_owner_change = {
	events = {
		japan.1			#Fall of the current Shogun
		flavor_tur.207	#Victory over the Knights
	}
	on_province_owner_change_government_effect = yes

	if = {
		limit = {
			owned_by = SRU
			exists = ARA
		}
		ARA = {
			set_country_flag = ARA_defeat_saruhan
		}
	}
	if = {
		limit = {
			NOT = { owner = { religion_group = muslim } }
			has_province_modifier = sufi_shrine
		}
		remove_province_modifier = sufi_shrine
	}
	on_province_owner_change_estate_privileges_effect = yes
	imperial_modifiers_on_province_change_culture_or_change_owner_effect = yes
	
	if = {
		limit = {
			region = indo_china_region
			has_building = farm_estate
			trade_goods = grain
			owner = {
				has_mission = mnd_khm_irrigation 
				NOT = {
					OR = {
						has_estate = estate_vaisyas
						has_estate = estate_burghers
					}
				}
			}
		}
		add_province_modifier = {
			name = grain_production_improved
			duration = 7300
		}
	}

	if = {
		limit = {
			trade_goods = gold
			NOT = { has_province_modifier = estate_burghers_control_over_gold_mine }
			owner = {
				has_estate_privilege = estate_burghers_control_over_the_mint
			}
		}
		add_province_modifier = {
			name = estate_burghers_control_over_gold_mine
			duration = -1
		}
	}
	
	if = {
		limit = {
			province_id = 379
			owner = {
				NOT = { religion = jewish }
			}
		}
		remove_country_modifier = third_temple_country_modifier
	}
	if = {
		limit = {
			owner = {
				has_country_modifier = son_fetishism_as_secondary_religion
			}
			religion = shamanism
			NOT = { has_province_modifier = son_fetishism_as_secondary_religion_province }
		}
		add_province_modifier = {
			name = son_fetishism_as_secondary_religion_province
			duration = -1
			desc = son_fetishism_as_secondary_religion_province_desc
		}
	}
	else_if = {
		limit = {
			OR = {
				owner = {
					NOT = { has_country_modifier = son_fetishism_as_secondary_religion }
				}
				NOT = { religion = shamanism }
			}
			has_province_modifier = son_fetishism_as_secondary_religion_province
		}
		remove_province_modifier = son_fetishism_as_secondary_religion_province
	}
	if = { 
		limit = { 
			owner = { NOT = { has_reform = jap_gokaido_reform } }
		}
		remove_province_modifier = jap_gokaido_modifier
	}

	if = {
		limit = {
			ROOT = { trade_goods = silver }
			NOT = { has_province_modifier = silver_debuff }
		}
		add_province_modifier = { 
			name = silver_debuff
			duration = -1
			hidden = yes	
		}
	}

	###cannon_foundry
	if = {
		limit = {
			AND = {
				ROOT = { has_building = cannon_foundry NOT = { has_building = off } }
				owner = { check_variable = { which = copper value = 0.4 } check_variable = { which = tin value = 0.3 } }	
			}
		}
		owner = {
			subtract_variable = { which = copper value = 0.4 }      
			subtract_variable = { which = tin value = 0.3 }        
			change_variable = { which = copper_used value = 0.4 }        
			change_variable = { which = tin_used value = 0.3 }         		
			change_variable = { which = cannon_foundry_amount value = 1 }         
		}
		FROM = {
			change_variable = { which = copper value = 0.4 }      
			change_variable = { which = tin value = 0.3 }        
			subtract_variable = { which = copper_used value = 0.4 }        
			subtract_variable = { which = tin_used value = 0.3 } 
			subtract_variable = { which = cannon_foundry_amount value = 1 }         			
		}
	}
	else_if = {
		limit = {
			AND = {
				ROOT = { has_building = cannon_foundry NOT = { has_building = off } }	
				owner = { NOT = { check_variable = { which = copper value = 0.4 } check_variable = { which = tin value = 0.3 } } }
			}
		}
		owner = {
			change_variable = { which = copper_used value = 0.4 }        
			change_variable = { which = tin_used value = 0.3 }
			change_variable = { which = cannon_foundry_amount value = 1 }
		}
		FROM = {
			subtract_variable = { which = copper_used value = 0.4 }        
			subtract_variable = { which = tin_used value = 0.3 }
			subtract_variable = { which = cannon_foundry_amount value = 1 } 
		}
	}
	if = {
		limit = { AND = { has_building = cannon_foundry has_building = off } }
		owner = {
			change_variable = {            
				which = cannon_foundry_amount
				value = 1
			}
		}
		FROM = {
			subtract_variable = {            
				which = cannon_foundry_amount
				value = 1
			}
		}
	}
	###metalworking_workshop
	if = {
		limit = {
			AND = {
				ROOT = { has_building = metalworking_workshop NOT = { has_building = off_2 } }
				owner = { check_variable = { which = iron value = 1.0 } }	
			}
		}
		owner = {
			subtract_variable = { which = iron value = 1.0 }             
			change_variable = { which = iron_used value = 1.0 }              		
			change_variable = { which = metalworking_workshop_amount value = 1 }         
		}
		FROM = {
			change_variable = { which = iron value = 1.0 }           
			subtract_variable = { which = iron_used value = 1.0 }        
			subtract_variable = { which = metalworking_workshop_amount value = 1 }         			
		}
	}
	else_if = {
		limit = {
			AND = {
				ROOT = { has_building = metalworking_workshop NOT = { has_building = off_2 } }	
				owner = { NOT = { check_variable = { which = iron value = 1.0 } } }
			}
		}
		owner = {
			change_variable = { which = iron_used value = 1.0 }        
			change_variable = { which = metalworking_workshop_amount value = 1 }
		}
		FROM = {
			subtract_variable = { which = iron_used value = 1.0 }        
			subtract_variable = { which = metalworking_workshop_amount value = 1 } 
		}
	}
	if = {
		limit = { AND = { has_building = metalworking_workshop has_building = off_2 } }
		owner = {
			change_variable = {            
				which = metalworking_workshop_amount
				value = 1
			}
		}
		FROM = {
			subtract_variable = {            
				which = metalworking_workshop_amount
				value = 1
			}
		}
	}
	###munition_factory
	if = {
		limit = {
			AND = {
				ROOT = { has_building = munition_factory NOT = { has_building = off_3 } }
				owner = { check_variable = { which = lead value = 1.0 } }	
			}
		}
		owner = {
			subtract_variable = { which = lead value = 1.0 }             
			change_variable = { which = lead_used value = 1.0 }              		
			change_variable = { which = munition_factory_amount value = 1 }         
		}
		FROM = {
			change_variable = { which = lead value = 1.0 }           
			subtract_variable = { which = lead_used value = 1.0 }        
			subtract_variable = { which = munition_factory_amount value = 1 }         			
		}
	}
	else_if = {
		limit = {
			AND = {
				ROOT = { has_building = munition_factory NOT = { has_building = off_3 } }	
				owner = { NOT = { check_variable = { which = lead value = 1.0 } } }
			}
		}
		owner = {
			change_variable = { which = lead_used value = 1.0 }        
			change_variable = { which = munition_factory_amount value = 1 }
		}
		FROM = {
			subtract_variable = { which = lead_used value = 1.0 }        
			subtract_variable = { which = munition_factory_amount value = 1 } 
		}
	}
	if = {
		limit = { AND = { has_building = munition_factory has_building = off_3 } }
		owner = {
			change_variable = {            
				which = munition_factory_amount
				value = 1
			}
		}
		FROM = {
			subtract_variable = {            
				which = munition_factory_amount
				value = 1
			}
		}
	}
	###spectacle_factory
	if = {
		limit = {
			AND = {
				ROOT = { has_building = spectacle_factory NOT = { has_building = off_5 } }
				owner = { check_variable = { which = glass value = 0.6 } }	
			}
		}
		owner = {
			subtract_variable = { which = glass value = 0.6 }             
			change_variable = { which = glass_used value = 0.6 }              		
			change_variable = { which = spectacle_factory_amount value = 1 }         
		}
		FROM = {
			change_variable = { which = glass value = 0.6 }           
			subtract_variable = { which = glass_used value = 0.6 }        
			subtract_variable = { which = spectacle_factory_amount value = 1 }         			
		}
	}
	else_if = {
		limit = {
			AND = {
				ROOT = { has_building = spectacle_factory NOT = { has_building = off_5 } }	
				owner = { NOT = { check_variable = { which = glass value = 0.6 } } }
			}
		}
		owner = {
			change_variable = { which = glass_used value = 0.6 }        
			change_variable = { which = spectacle_factory_amount value = 1 }
		}
		FROM = {
			subtract_variable = { which = glass_used value = 0.6 }        
			subtract_variable = { which = spectacle_factory_amount value = 1 } 
		}
	}
	if = {
		limit = { AND = { has_building = spectacle_factory has_building = off_5 } }
		owner = {
			change_variable = {            
				which = spectacle_factory_amount
				value = 1
			}
		}
		FROM = {
			subtract_variable = {            
				which = spectacle_factory_amount
				value = 1
			}
		}
	}
	###cigars_factory
	if = {
		limit = {
			AND = {
				ROOT = { has_building = cigars_factory NOT = { has_building = off_6 } }
				owner = { check_variable = { which = tobacco value = 0.6 } }	
			}
		}
		owner = {
			subtract_variable = { which = tobacco value = 0.6 }             
			change_variable = { which = tobacco_used value = 0.6 }              		
			change_variable = { which = cigars_factory_amount value = 1 }         
		}
		FROM = {
			change_variable = { which = tobacco value = 0.6 }           
			subtract_variable = { which = tobacco_used value = 0.6 }        
			subtract_variable = { which = cigars_factory_amount value = 1 }         			
		}
	}
	else_if = {
		limit = {
			AND = {
				ROOT = { has_building = cigars_factory NOT = { has_building = off_6 } }	
				owner = { NOT = { check_variable = { which = tobacco value = 0.6 } } }
			}
		}
		owner = {
			change_variable = { which = tobacco_used value = 0.6 }        
			change_variable = { which = cigars_factory_amount value = 1 }
		}
		FROM = {
			subtract_variable = { which = tobacco_used value = 0.6 }        
			subtract_variable = { which = cigars_factory_amount value = 1 } 
		}
	}
	if = {
		limit = { AND = { has_building = cigars_factory has_building = off_6 } }
		owner = {
			change_variable = {            
				which = cigars_factory_amount
				value = 1
			}
		}
		FROM = {
			subtract_variable = {            
				which = cigars_factory_amount
				value = 1
			}
		}
	}
	###chocolate_factory
	if = {
		limit = {
			AND = {
				ROOT = { has_building = chocolate_factory NOT = { has_building = off_7 } }
				owner = { check_variable = { which = cocoa value = 0.6 } }	
			}
		}
		owner = {
			subtract_variable = { which = cocoa value = 0.6 }             
			change_variable = { which = cocoa_used value = 0.6 }              		
			change_variable = { which = chocolate_factory_amount value = 1 }         
		}
		FROM = {
			change_variable = { which = cocoa value = 0.6 }           
			subtract_variable = { which = cocoa_used value = 0.6 }        
			subtract_variable = { which = chocolate_factory_amount value = 1 }         			
		}
	}
	else_if = {
		limit = {
			AND = {
				ROOT = { has_building = chocolate_factory NOT = { has_building = off_7 } }	
				owner = { NOT = { check_variable = { which = cocoa value = 0.6 } } }
			}
		}
		owner = {
			change_variable = { which = cocoa_used value = 0.6 }        
			change_variable = { which = chocolate_factory_amount value = 1 }
		}
		FROM = {
			subtract_variable = { which = cocoa_used value = 0.6 }        
			subtract_variable = { which = chocolate_factory_amount value = 1 } 
		}
	}
	if = {
		limit = { AND = { has_building = chocolate_factory has_building = off_7 } }
		owner = {
			change_variable = {            
				which = chocolate_factory_amount
				value = 1
			}
		}
		FROM = {
			subtract_variable = {            
				which = chocolate_factory_amount
				value = 1
			}
		}
	}
	###steam_engine_manu
	if = {
		limit = {
			AND = {
				ROOT = { has_building = steam_engine_manu NOT = { has_building = off_4 } }
				owner = { check_variable = { which = copper value = 0.4 } check_variable = { which = zinc value = 0.3 } }	
			}
		}
		owner = {
			subtract_variable = { which = copper value = 0.4 }      
			subtract_variable = { which = zinc value = 0.3 }        
			change_variable = { which = copper_used value = 0.4 }        
			change_variable = { which = zinc_used value = 0.3 }         		
			change_variable = { which = steam_engine_manu_amount value = 1 }         
		}
		FROM = {
			change_variable = { which = copper value = 0.4 }      
			change_variable = { which = zinc value = 0.3 }        
			subtract_variable = { which = copper_used value = 0.4 }        
			subtract_variable = { which = zinc_used value = 0.3 } 
			subtract_variable = { which = steam_engine_manu_amount value = 1 }         			
		}
	}
	else_if = {
		limit = {
			AND = {
				ROOT = { has_building = steam_engine_manu NOT = { has_building = off_4 } }	
				owner = { NOT = { check_variable = { which = copper value = 0.4 } check_variable = { which = zinc value = 0.3 } } }
			}
		}
		owner = {
			change_variable = { which = copper_used value = 0.4 }        
			change_variable = { which = zinc_used value = 0.3 }
			change_variable = { which = steam_engine_manu_amount value = 1 }
		}
		FROM = {
			subtract_variable = { which = copper_used value = 0.4 }        
			subtract_variable = { which = zinc_used value = 0.3 }
			subtract_variable = { which = steam_engine_manu_amount value = 1 } 
		}
	}
	if = {
		limit = { AND = { has_building = steam_engine_manu has_building = off_4 } }
		owner = {
			change_variable = {            
				which = steam_engine_manu_amount
				value = 1
			}
		}
		FROM = {
			subtract_variable = {            
				which = steam_engine_manu_amount
				value = 1
			}
		}
	}
	
	FROM = { 
		country_event = { id = New_TradeGood_Events.2 days = 3 }
	}
	owner = {
		country_event = { id = New_TradeGood_Events.2 days = 3 }
		country_event = { id = New_TradeGood_Events.50 days = 25 }
	}
	
	#ME Stuff
	if = {
		limit = {
			owner = {
				has_country_modifier = me_mug_shipbuilding_industry
			}
			trade_goods = naval_supplies
		}
		add_province_modifier = {
			name = me_mug_shipbuilding_province
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			has_province_modifier = me_mug_shipbuilding_province
			owner = {
				NOT = {
					has_country_modifier = me_mug_shipbuilding_industry
				}
			}
		}
		remove_province_modifier = me_mug_shipbuilding_province
	}
	
	if = {
		limit = {
			owner = {
				has_estate_privilege = ME_estate_burghers_steppe_development
			}
			has_terrain = steppe
		}
		add_province_modifier = {
			name = estate_burghers_steppe_development
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			has_province_modifier = estate_burghers_steppe_development
			owner = {
				NOT = {
					has_estate_privilege = ME_estate_burghers_steppe_development
				}
			}
		}
		remove_province_modifier = estate_burghers_steppe_development
	}
	if = {
		limit = {
			primary_culture = persian
			has_country_modifier = me_tim_persian_empire
		}
		every_owned_province = {
			limit = {
				culture = ROOT
			}
			add_province_modifier = {
				name = me_tim_persian_empire_province
				duration = -1
				hidden = yes
			}
		}
	}
	if = {
		limit = {
			OR = {
				has_terrain = hills 
				has_terrain = mountain 
				has_terrain = highlands 
			}
			owner = {
				has_country_flag = alpine_development_modifier_province_flag
			}
		}
		add_province_modifier = {
			name = alp_mountain_development
			duration = -1
		}
	}

	update_monuments_dependence = yes
	FROM = { riverupdate = yes }
	owner = { riverupdate = yes }
	run_on_province_owner_change_compatability_effects = yes


}

#ROOT = province that was centralized in
on_centralized_state = {
	if = {
		limit = {
			owner = { has_government_attribute = centralize_state_no_reform_cost }
		}
		owner = {
			add_adm_power = 50
			change_government_reform_progress = 50
		}
	}
	else_if = {
		limit = {
			owner = { has_government_attribute = centralize_state_half_refund }
		}
		owner = {
			add_adm_power = 25
			change_government_reform_progress = 25
		}
	}
	if = {
		limit = {
			owner = { has_government_attribute = centralize_state_development }
		}
		area = {
			limit = {
				owned_by = ROOT
			}
			random_list = {
				1 = { add_base_tax = 1 }
				1 = { add_base_production = 1 }
				1 = { add_base_manpower = 1 }
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_centralize_state_discount
			}
		}
		owner = {
			add_adm_power = 25
			change_government_reform_progress = 25
		}
	}
}

on_loan_repaid = {
	on_loan_repaid_estate_privileges_effect = yes
	
	if = {
		limit = {
			has_country_flag = MAM_repaying_loans_gives_lower_inflation
		}
		add_inflation = -0.1
	}
	else_if = {
		limit = { economic_ideas = 2 }
		add_inflation = -0.05
	}
	else = { }
}

#ROOT = province
on_adm_exploited = {
	ME_on_exploit_development = yes
	if = {
		limit = { owner = { has_government_attribute = may_not_reduce_tax_on_exploitation } }
		random = {
			chance = 50
			add_base_tax = 1
		}
	}
	if = {
		limit = { owner = { has_government_attribute = may_not_reduce_tax_on_own_exploitation culture_group = ROOT } }
		random = {
			chance = 25
			add_base_tax = 1
		}
	}
	if = {
		limit = { owner = { has_government_attribute = may_not_reduce_tax_on_foreign_exploitation NOT = { culture_group = ROOT } } }
		random = {
			chance = 50
			add_base_tax = 1
		}
	}
}
on_dip_exploited = {
	ME_on_exploit_development = yes
}
on_mil_exploited = {
	ME_on_exploit_development = yes
}

on_reform_enacted = {
	if = {
		limit = {
			mission_completed = ME_tim_military_administration
		}
		add_army_professionalism = 0.05
		add_army_tradition = 10
	}

	if = {
		limit = {
			mission_completed = EE_syn_governing_capacity
		}
		add_adm_power = 100
		add_dip_power = 100
		add_mil_power = 100
		change_adm = 1
		change_dip = 1
		change_mil = 1
	}
}

# province
on_consecrate_patriarch = {
	if = {
		limit = {
			owner = { has_country_flag = has_improved_consecration }
		}
		add_province_modifier = {
			name = consecrated_ground
			duration = -1
			hidden = yes
		}
	}
	
	if = {
		limit = {
			NOT = { has_province_flag = ee_byz_consecrated }
			owner = {
				has_government_attribute = enables_reform_progress_on_metrapolitan
			}
		}
		area = {
			set_province_flag = ee_byz_consecrated
		}
		owner = {
			change_government_reform_progress = 10
		}
	}
}
