# Missions Expanded on actions
# Remember to keep the vanilla effects

# province
on_adm_development = {
	ME_on_development = yes

	owner = {
		change_variable = {
			which = num_of_adm_clicks
			value = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = ARB_extra_base_tax
			}
		}
		owner = {
			random_owned_province = {
				add_base_tax = 1
			}
		}
	}
	
	if = {
		limit = { owner = { has_country_flag = enable_supplemental_development_flag } }
		random_list = {
			20 = { add_base_tax = 1 }
			80 = { }
		}
	}
	if = {
		limit = { 
			owner = {
				tag = POL 
				is_subject_of = ROOT 
				OR = {
					has_country_modifier = lit_increased_dev_modifier
					overlord = { has_country_modifier = lit_increased_dev_modifier }
				}
			}
		}
		add_base_tax = 1 
	}
	
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = polish
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_tax = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_hab_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			culture = armenian
			owner = {
				OR = {
					has_mission = QAR_catholicoi
					tag = QAR
					was_tag = QAR
				}
			}
		}
		owner = {
			change_variable = {
				which = QAR_developed_armenia
				value = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}

	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_tax = 1 } 
			90 = { } 
		}
	}
	if = {
		limit = {
			owner = {
				has_country_flag = ORM_deving_adm_in_trade_center
			}
		}
		owner = {
			add_mercantilism = 1
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}
	if = {
        limit = {
            has_country_flag = me_mug_dashala
        }
        random = {
            chance = 50
            add_base_tax = 1
        }
    }
}

# province
on_dip_development = {
	ME_on_development = yes

	if = {
		limit = { owner = { has_country_flag = enable_supplemental_development_flag } }
		random_list = {
			20 = { add_base_production = 1 }
			80 = { }
		}
	}
	if = {
		limit = { 
			owner = {
				tag = POL 
				is_subject_of = ROOT 
				has_country_modifier = lit_increased_dev_modifier
			}
		}
		add_base_production = 1 
	}
	
	 if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = polish
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_grain_double_dev
			}
		}
		random = { 
			chance = 50 

			add_base_production = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_production = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_hab_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_production = 1 } 
			90 = { } 
		}
	}
}

# province
on_mil_development = {
	ME_on_development = yes
	
	if = {
		limit = { owner = { has_country_flag = enable_supplemental_development_flag } }
		random_list = {
			20 = { add_base_manpower = 1 }
			80 = { }
		}
	}
	if = {
		limit = { 
			owner = {
				tag = POL 
				is_subject_of = ROOT 
				has_country_modifier = lit_increased_dev_modifier
			}
		}
		add_base_manpower = 1 
	}
	
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				OR = {
					culture = polish
					culture = schlesian
				}
			}
			owner = {
				change_variable = { ME_polish_loyalty = 0.5 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 0.5 }
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				OR = {
					has_reform = me_hofkammer_reform
					has_country_flag = 20_percent_chance_for_extra_dev
				}
			}
		}
		random = { 
			chance = 20
			
			add_base_manpower = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_increase_minority_loyalty_through_development
			}
			OR = {
				area = moravia_area
				area = bohemia_area
				area = erzgebirge_area
				area = transdanubia_area
				area = alfold_area
				area = slovakia_area
			}
		}
		owner = {
			add_estate_loyalty = {
				estate = me_hab_cultural_minorities
				loyalty = 1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_treasurer
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = { 
		limit = { 
			owner = { mission_completed = slo_lightning } 
		}
		random_list = { 
			10 = { add_base_manpower = 1 } 
			90 = { } 
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_urbanization_begin
			}
			development = 30
			NOT = {
				has_province_modifier = me_mug_urban_centre
			}
		}
		add_province_modifier = {
			name = me_mug_urban_centre
			duration = -1
		}
	}

	if = {
		limit = {
			owner = { mission_completed = ME_tim_national_militias }
		}
		random_list = { 
			10 = { add_base_manpower = 1 } 
			90 = { } 
		}
	}
}

on_province_culture_converted = {
	on_province_culture_converted_estate_privilges_effect = yes
	judaism_on_province_culture_converted_effect = yes
	kongo_on_province_change_culture_or_change_owner_effect = yes
	if = {
		limit = {
			has_province_flag = got_loyalty_for_culture
		}
		clr_province_flag = got_loyalty_for_culture
	}
	if = {
		limit = {
			owner = {
				has_reform = west_slavic_monarchy
			}
		}
		if = {
			limit = {
				culture = slovak
			}
			owner = {
				change_variable = { ME_slovak_loyalty = 1 }
			}
		}
		else_if = {
			limit = {
				OR = {
					culture = polish
					culture = schlesian
				}
			}
			owner = {
				change_variable = { ME_polish_loyalty = 1 }
			}
		}
		else_if = {
			limit = {
				culture = czech
			}
			owner = {
				change_variable = { ME_czech_loyalty = 1 }
			}
		}
	}
	owner = {
		change_variable = { num_of_culture_converted_provinces = 1 }
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			culture_group = ROOT
		}
		remove_province_modifier = me_hab_development_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			NOT = { culture_group = ROOT }
		}
		add_province_modifier = {
			name = me_hab_development_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			culture_group = ROOT
		}
		remove_province_modifier = me_hab_conscription_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			NOT = { culture_group = ROOT }
		}
		add_province_modifier = {
			name = me_hab_conscription_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_estate_privilege = estate_turkic_tribes_settle_the_tribes
			}
			culture = owner
		}
		owner = {
			add_estate_loyalty = {
				estate = estate_turkic_tribes
				loyalty = 5
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_tim_persian_empire
				primary_culture = persian
			}
			
		}
		add_province_modifier = {
			name = me_tim_persian_empire_province
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_modifier = me_tim_persian_empire
				NOT = { primary_culture = persian }
			}
		}
		remove_province_modifier = me_tim_persian_empire_province
	}
}

on_primary_culture_changed = {
	on_primary_culture_changed_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_primary_culture_change_effect = yes
	
	if = {
		limit = {
			primary_culture = persian
			NOT = { has_country_modifier = me_tim_persian_empire }
			has_country_flag = me_tim_persian_empire_flag
		}
		add_country_modifier = {
			name = me_tim_persian_empire
			duration = -1
			desc = me_tim_until_we_are_not_persian
		}
		every_owned_province = {
			limit = {
				culture = ROOT
			}
			add_province_modifier = {
				name = me_tim_persian_empire_province
				duration = -1
				hidden = yes
			}
		}
	}
	else_if = {
		limit = {
			NOT = { primary_culture = persian }
			has_country_modifier = me_tim_persian_empire
		}
		remove_country_modifier = me_tim_persian_empire_province
		set_country_flag = me_tim_persian_empire_flag
		every_owned_province = {
			limit = {
				culture = ROOT
			}
			remove_province_modifier = me_tim_persian_empire_province
		}
	}
}


# ROOT = Tag that captured the flagship, FROM = Tag that lost the flagship
on_flagship_captured = {
	FROM = {
		set_country_flag = captured_flagship_country_flag
	}
	ROOT = {
		country_event = { id = flagship_events.2 }
		set_country_flag = trophy_hunter_flag
		set_country_flag = captured_flagship_of_@FROM
	}
	FROM = {
		country_event = { id = flagship_events.1 }
	}
	
	FROM = { 
		if = { 
			limit = { has_country_modifier = hsa_pride_eagle_of_the_fleet_modifier }
			remove_country_modifier = hsa_pride_eagle_of_the_fleet_modifier
		}
	}
}

# ROOT = winning country, FROM = loser country
on_battle_won_country = {
	if = {
		limit = {
			ROOT = {
				tag = ALB
				NOT = { has_country_flag = albanian_victory }
			}
			FROM = {
				tag = TUR
			}
		}
		ROOT = { set_country_flag = albanian_victory }
	}
	if = {
		limit = {
			ROOT = {
				religion = jewish
				has_church_aspect = judaism_purim_teachings_aspect
			}
		}
		ROOT = {
			add_war_exhaustion = -0.05
		}
	}
	count_won_battles_and_reward_at_end = {
		counting_flag = teu_crusader_battle_counter
		max_value = 20
		effect = "
			country_event = {
				id = flavor_teu.12
			}
		"
	}
	if = {
		limit = {
			tag = ILK
			FROM = {
				tag = MAM
			}
		}
		country_event = { id = ME_Ilkhanate_Events.8 }
	}
	if = {
		limit = {
			mission_completed = takeda_rise_of_takeda_shingen
		}
		change_variable = { which = num_of_won_battles value = 1 }
	}
	
	if = {
		limit = {
			has_country_modifier = me_hab_imperial_marshall
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	if = {
		limit = {
			has_country_flag = GRA_incident_castile
			FROM = { tag = CAS }
		}
		change_variable = { which = Granada_battles_won value = 1 }
	}
	if = {
		limit = {
			has_country_modifier = MSY_the_end_is_nigh
		}
		add_disaster_progress = {
			disaster = ME_the_end_of_times
			value = -0.5
		}
	}
	if = {
		limit = {
			has_country_flag = RUM_pp_from_battles
			variable_arithmetic_trigger = {
				export_to_variable = {
					which = RUM_our_discipline
					value = trigger_value:discipline
				}
				export_to_variable = {
					which = RUM_their_discipline
					value = trigger_value:discipline
					who = FROM
				}
				check_variable = {
					which = RUM_their_discipline
					which = RUM_our_discipline
				}
			}
		}
		add_power_projection = {
			type = RUM_battles
			amount = 1
		}
	}
	if = {
		limit = {
			has_country_flag = ME_can_use_timurid_legitimacy
		}
		change_variable = {
			which = timurid_legitimacy_value
			value = 2
		}
	}
	
	change_variable = {
		which = num_of_battles_won_var
		value = 1
	}
	if = {
		limit = {
			OR = {
				AND = {
					mission_completed = TIM_every_corner
					mission_completed = TIM_elephants_for_governors
				}
				AND = {
					overlord = {
						mission_completed = TIM_every_corner
						mission_completed = TIM_elephants_for_governors
					}
				}
			}
		}
		change_variable = {
			which = METimBattlesWonFinal
			value = 1
		}
	}

	if = {
		limit = {
			has_government_attribute = enables_spoils_of_war
			NOT = { has_country_flag = ME_tim_battle_tendency_mission_flag }
		}
		ME_tim_add_spoils_of_war = { add = 1 }
	}
	else_if = {
		limit = {
			has_government_attribute = enables_spoils_of_war
			has_country_flag = ME_tim_battle_tendency_mission_flag
		}
		ME_tim_add_spoils_of_war = { add = 2 }
	}

	if = {
		limit = {
			mission_completed = ME_tim_army_with_a_state
		}
		add_militarised_society = 2
	}

	if = {
		limit = {
			mission_completed = ME_tim_army_professionalism
		}
		add_army_professionalism = 0.002
	}
}

on_battle_won_unit = {
	if = {
		limit = {
			unit_owner = { ai = no } #Scopes to Unit Owner from Unit Scope
			general_with_steam_name = yes #Unit Scope Trigger
		}
		unit_owner = { set_country_flag = general_with_steam_name_won_battle }
	}
	if = {
		limit = {
			general_with_name = "Damarwulan"
		}
		unit_owner = {
			change_variable = {
				which = DamarwulanWinVariable 
				value = 1
			}
		}
	}
	if = {
		limit = {
			template = me_tim_war_elephants
		}
		unit_owner = {
			change_variable = {
				which = METimElephantBattlesWon
				value = 1
			}
		}
	}
	if = {
		limit = {
			general_with_name = "Damarwulan"
			unit_owner = {
				check_variable = {
					which = DamarwulanWinVariable
					value = 5
				}
			}
		}
		unit_owner = {
			country_event = { id = majapahit.2 days = 2 }
		}
	}
	
	if = {
		limit = {
			general_with_name = "Pir Budaq"
			unit_owner = {
				has_country_flag = QAR_pir_budaq_10_battles
			}
		}
		unit_owner = {
			change_variable = {
				which = QAR_pir_budaq_10_battles 
				value = 1
			}
		}
	}
	if = {
		limit = {
			general_with_name = "Pir Budaq"
			unit_owner = {
				has_country_flag = QAR_pir_budaq_10_battles
			}
			unit_owner = {
				check_variable = {
					which = QAR_pir_budaq_10_battles
					value = 10
				}
			}
		}
		unit_owner = {
			clr_country_flag = QAR_pir_budaq_10_battles
			set_variable = {
				which = QAR_pir_budaq_10_battles
				value = 0
			}
			country_event = { id = ME_Qara_Qoyunlu_Events.27 days = 2 }
		}
	}
	
	if = {
		limit = {
			unit_owner = {
				mission_completed = son_military_expertise
				NOT = { mission_completed = son_win_battles }
			}
		}
		unit_owner = {
			change_variable = {
				which = son_fight_counter
				value = 1
			}
		}
		if = {
			limit = {
				is_ruler_commanding_unit = yes
			}
			unit_owner = {
				change_variable = {
					which = son_fight_counter
					value = 1
				}
			}
		}
	}
	if = {
		limit = {
			unit_owner = {
				has_government_attribute = winning_battles_increases_legitimacy
			}
			is_ruler_commanding_unit = yes
		}
		unit_owner = {
			add_legitimacy = 0.5
			add_devotion = 0.5
			add_republican_tradition = 0.1
			add_revolutionary_zeal = 0.1
			add_absolutism = 0.1
		}
	}
	 if = {
        limit = {
            unit_owner = {
                has_country_flag = ME_tim_battle_tendency_mission_flag
            }
            is_ruler_commanding_unit = yes
        }
        unit_owner = {
            add_estate_loyalty = {
				estate = estate_nomadic_tribes
				loyalty = 5
			}
        }
    }

	if = {
        limit = {
            unit_owner = {
                has_country_flag = me_tim_ruler_victories_give_reform_progress
            }
            is_ruler_commanding_unit = yes
        }
        unit_owner = {
            change_government_reform_progress = 1
        }
    }
}
# THIS = Province, FROM = Country, ROOT = Merc Unit
on_mercenary_recruited = {
	if = {
		limit = {
			FROM = { has_country_flag = GRA_cut_penalty_in_half }
			ROOT = { 
				home_province = {
					religion = FROM
				}
			}
		}
		FROM = { add_army_professionalism = -0.025 }
	}
	else_if = {
		limit = {
			NOT = {
				OR = {
					vanilla_on_mercenary_recruited_trigger = yes
					missions_expanded_on_mercenary_recruited_trigger = yes
				}
			}
		}
		FROM = {
			add_army_professionalism = -0.05
		}
	}
	if = {
		limit = {
			OR = {
				template = MCE_merc_knights_cyprus
				template = MCE_merc_knights_hospitaller
				template = MCE_merc_knights_of_calatrava
				template = MCE_merc_knights_of_santiago
				template = MCE_merc_brotherhood_of_the_holy_sepulchre
				template = MCE_merc_livonia_order
			}
			FROM = {
				religion = catholic
			}
		}
		FROM = {
			add_papal_influence = -15
		}
	}
	if = {
		limit = {
			template = MCE_merc_brotherhood_of_the_holy_sepulchre
			FROM = {
				religion = orthodox
			}
		}
		add_patriarch_authority = -0.05
	}
}

on_culture_promoted = {
	if = {
		limit = {
			has_country_flag = habsburg_glory_unlocked
		}
		HAB_change_habsburg_glory = { amount = 5 }
	}
	on_culture_promoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	kongo_on_culture_country_effect = yes
}

on_culture_demoted = {
	if = {
		limit = {
			has_country_flag = habsburg_glory_unlocked
		}
		HAB_change_habsburg_glory = { amount = -7 }
	}
	on_culture_demoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	kongo_on_culture_country_effect = yes
	on_culture_demoted_effect = yes
}

on_weak_heir_claim = {
	if = {
		limit = {
			has_country_flag = habsburg_glory_unlocked
		}
		HAB_change_habsburg_glory = { amount = -5 }
	}
	events = {
		611		# Pretenders rise up
	}
}

on_successive_emperor  = {
	if = {
		limit = {
			has_country_flag = habsburg_glory_unlocked
		}
		HAB_change_habsburg_glory = { amount = 2 }
	}
	emperor = {
		save_global_event_target_as = Emperor
	}
	events = {
		900
	}
}

#on_four_year_pulse_4 = {
#	random_events = {
#		# Board of Personnel chain
#		100 = ME_Manchu_Events.17
#		100 = ME_Manchu_Events.18
#		100 = ME_Manchu_Events.19
#
#		# Bourd of Revenue chain
#		100 = ME_Manchu_Events.21
#		100 = ME_Manchu_Events.22
#		100 = ME_Manchu_Events.23
#	}
#}

on_golden_bull_enacted = {
	set_country_flag = enacted_golden_bull
	
	if = {
		limit = {
			has_country_flag = me_pi_from_bulls
		}
		add_papal_influence = 30
	}
}

on_battle_lost_unit = {
    if = {
        limit = {
            unit_owner = {
                tag = MNG
                has_ruler_flag = mng_militry_incompetence
            }
            is_ruler_commanding_unit = yes
			enemy_unit = {
				unit_owner = {
					tag = OIR
				}
			}
        }
        OIR = {
            country_event = { id = flavor_oir.2 }
        }
    }
	
	if = {
		limit = {
			unit_owner = {
				tag = BUR
			}
			enemy_unit = {
				unit_owner = {
					has_country_flag = me_bur_beating_bur_king_in_battle
				}
			}
		}
		unit_owner = {
			random = { 
				chance = 10
				
				country_event = { id = incidents_bur_inheritance.1 }
			}
		}
	}
}

on_general_recruited = {
	if = { 
		limit = { 
			OR = {
				has_country_flag = tur_acemi_oglan_academy_3_flag
				has_country_modifier = pol_trigger_for_army_professionalism_modifier
			}
		}
		add_army_professionalism = 0.0125
	}
	else = { add_army_professionalism = 0.01 }
	if = {
		limit = {
			has_country_modifier = me_hab_general_staff
		}
		add_army_tradition = 2
		if = {
			limit = {
				num_of_generals = 10
				NOT = { has_country_modifier = me_hab_staff_planning }
			}
			add_country_modifier = {
				name = me_hab_staff_planning
				duration = -1
			}
		}
	}
	
	if = {
		limit = { has_government_attribute = recruiting_generals_increases_nobles_loyalty }
		if = {
			limit = {
				has_estate = estate_nobles
			}
			add_estate_loyalty = {
				estate = estate_nobles
				loyalty = 2
			}
		}
		if = {
			limit = {
				has_estate = estate_maratha
			}
			add_estate_loyalty = {
				estate = estate_maratha
				loyalty = 2
			}
		}
		if = {
			limit = {
				has_estate = estate_rajput
			}
			add_estate_loyalty = {
				estate = estate_rajput
				loyalty = 2
			}
		}
	}

	if = {
		limit = {
			mission_completed = ME_tim_military_loyalty
		}
		add_army_professionalism = 0.01
	}
}

# province:  spawned whenever a new owner takes over the province
# FROM = The previous owner.
on_conquest = {
	remove_named_unrest = estate_land_seized
	clr_province_flag = has_estate_unrest_flag
	
	if = {
		limit = {
			has_country_flag = me_hab_venetian_modifier
		}
		if = {
			limit = {
				venetia_area = {
					type = all
					owned_by = ROOT
				}
			}
			owner = {
				add_country_modifier = {
					name = me_hab_venetian_sailors
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				NOT = {
					venetia_area = {
						type = all
						owned_by = ROOT
					}
				}
			}
			FROM = {
				remove_country_modifier = me_hab_venetian_sailors
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				NOT = { has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces }
			}
			has_country_modifier = me_hab_development_law
		}
		remove_country_modifier = me_hab_development_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_dev_cost_in_foreign_culture_provinces
			}
			NOT = { has_country_modifier = me_hab_development_law }
		}
		add_province_modifier = {
			name = me_hab_development_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		owner = {
			add_disaster_progress = {
				disaster = ME_the_end_of_times
				value = -0.3
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				NOT = { has_country_flag = me_hab_conscription_on_foreign_provinces }
			}
			has_country_modifier = me_hab_conscription_law
		}
		remove_country_modifier = me_hab_conscription_law
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = me_hab_conscription_on_foreign_provinces
			}
			NOT = { has_country_modifier = me_hab_conscription_law }
		}
		add_province_modifier = {
			name = me_hab_conscription_law
			duration = -1
		}
	}
	
	if = {
		limit = {
			FROM = {
				has_country_modifier = me_hab_iberian_ties
				has_country_flag = me_hab_iberian_ties_flag
			}
			NOT = {
				iberia_region = {
					type = all
					country_or_non_sovereign_subject_holds = ROOT
				}
			}
		}
		remove_country_modifier = me_hab_iberian_ties
	}
	else_if = {
		limit = {
			FROM = {
				has_country_flag = me_hab_iberian_ties_flag
				NOT = { has_country_modifier = me_hab_iberian_ties }
			}
			iberia_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		add_country_modifier = {
			name = me_hab_iberian_hegemony
			duration = -1
		}
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_horde_path
			}
		}
		owner = {
			change_variable = {
				which = METimConquestHorde
				value = 1
			}
		}
	}

	if = {
		limit = {
			owner = {
				has_country_modifier = ME_tim_horsemen_of_apocalypse_modifier
			}
			development = 3
		}
		add_base_tax = 1
	}
}

# country
# root = winning country, from = loser country
on_war_won = {
	FROM = { country_event = { id = flavor_cri.6 } }
	ROOT = { country_event = { id = tributary_events.32 } }
	
	if = {
		limit = {
			is_part_of_hre = yes
			FROM  = { is_part_of_hre = yes }
		}
		ROOT = { save_global_event_target_as = hre_winner }
		FROM = { save_global_event_target_as = hre_loser }
		random_known_country = {
			limit = {
				has_reform = free_city
				NOT = {
					prestige = 40
				}
				NOT = {
					has_country_modifier = fc_treatyconference_timer
				}
			}
			add_country_modifier = {
				name = fc_treatyconference_timer
				duration = 3650
				hidden = yes
			}
			country_event = {
				id = free_cities.7
				days = 7
			}
		}
	}

	if = {
		limit = {
			has_country_modifier = me_tim_stampede_the_traitor 
			NOT = {
				war_with = QOM
			}
		}
		remove_country_modifier = me_tim_stampede_the_traitor
	}

	if = {
		limit = {
			tag = MLO
			NOT = { has_country_flag = emp_mlo_won_war_with_swiss_mercs }
			any_hired_mercenary_company = {
				home_province = {
					OR = {
						area = switzerland_area
						area = romandie_area
					}
				}
			}
		}
		set_country_flag = emp_mlo_won_war_with_swiss_mercs
	}
	
	if = {
		limit = {
			is_hiring_condottiere_from = SWI
		}
		SWI = { set_country_flag = won_condottiere_war }
		if = {
			limit = {
				tag = PAP
			}
			SWI = {
				set_country_flag = hired_to_pope
			}
		}
	}
	
	if = {
		limit = {
			primary_culture = melanesian
			NOT = { has_country_modifier = warlord_mod }
		}
		FROM = {
			country_event = {
				id = polynesian.17
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				religion = jewish
				has_church_aspect = judaism_purim_teachings_aspect
			}
		}
		add_church_power = 10
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					OR = {
						area = lower_swabia_area
						area = upper_swabia_area
					}
				}
			}
		}
		FROM = {
			set_country_flag = me_hab_beaten_by_habsburgs
		}
		change_variable = {
			which = meBeatSwabians
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_von_haugwitz_reforms
		}
		change_variable = {
			which = MEHABWarsWon
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_tim_win_wars
		}
		change_variable = {
			which = METimWonWars
			value = 1
		}
	}
	
	if = {
		limit = {
			mission_completed = TIM_army_reforms
		}
		change_variable = {
			which = METimWarsWon1
			value = 1
		}
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					continent = europe
				}
			}
		}
		change_variable = {
			which = me_tim_europe_victory
			value = 1
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_von_haugwitz_reforms
			is_at_war = no
		}
		remove_country_modifier = me_hab_wartime_army
		add_country_modifier = {
			name = me_hab_peacetime_army
			duration = -1
			desc = me_as_long_as_we_are_at_peace
		}
	}
	
	if = {
		limit = {
			has_country_flag = me_hab_hofkriegstrat_flag
			is_at_war = no
		}
		remove_country_modifier = me_hab_war_council
	}
	
	if = {
		limit = {
			FROM = {
				capital_scope = {
					is_part_of_hre = no
				}
			}
		}
		change_variable = {
			which = MEHabBeatenEnemies
			value = 1
		}
	}
	if = {
		limit = {
			FROM = {
				NOT = { religion = ROOT }
			}
		}
		change_variable = {
			which = ME_num_of_heathen_heretic_wars_won
			value = 1
		}
	}
		
	
	if = {
		limit = {
			has_global_flag = imperial_treasurer_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_treasurer
				}
			}
		}
		clr_global_flag = imperial_treasurer_established
	}
	
	if = {
		limit = {
			has_global_flag = imperial_marshall_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_marshall
				}
			}
		}
		clr_global_flag = imperial_marshall_established
	}
	
	if = {
		limit = {
			has_global_flag = imperial_court_chaplain_established
			NOT = {
				any_known_country = {
					has_country_modifier = me_hab_imperial_court_chaplain
				}
			}
		}
		clr_global_flag = imperial_court_chaplain_established
	}
	
	if = {
		limit = {
			NOT = { has_country_flag = me_hab_won_against_swiss }
			tag = HAB
			FROM = {
				tag = SWI
			}
		}
		set_country_flag = me_hab_won_against_swiss
	}
	
	if = {
		limit = {
			has_country_flag = can_gain_legendary_pirates_flag
			NOT = { has_ruler_flag = historical_pirate }
			has_government_attribute = is_pirate_republic_reform
			FROM = { total_development = ROOT }
		}
		random = {
			chance = 5
			country_event = {
				id = pirates.25
			}
		}
	}
	
	if = {
		limit = {
			tag = TUN
			FROM = {
				has_country_flag = TUN_abu_l_hasan
				ai = yes 
			}
		}
		add_yearly_manpower = 1.5
		FROM = {
			every_owned_province = {
				random_core_country = {
					every_core_province = {
						limit = {
							owned_by = FROM
						}
						cede_province = PREV
					}
				}
			}
			random_neighbor_country = {
				limit = {
					ai = yes
				}
				save_event_target_as = TUN_annex_us
			}
			if = {
				limit = {
					has_saved_event_target = TUN_annex_us
				}
				every_owned_province = {
					add_core = ROOT
					cede_province = event_target:TUN_annex_us
				}
			}
		}
	}
	else_if = {
		limit = {
			has_country_flag = TUN_abu_l_hasan
			FROM = {
				tag = TUN
				ai = yes 
			}
		}
		if = {
			limit = {
				NOT = { exists = TRP }
			}
			FROM = { change_tag = TRP }
		}
		remove_country_modifier = TUN_abu_l_hasans_rebellion_modifier
	}
	else = { }
	
	if = {
		limit = {
			has_global_flag = GHD_some_nation_set_west_africa_on_fire
			technology_group = sub_saharan 
			FROM = {
				technology_group = sub_saharan 
			}
		}
		every_country = {
			# every_trade_node_member_country = {
			limit = {
				has_country_flag = GHD_nations_in_west_africa_fighting_wars_buff_us
				NOT = { tag = FROM }
				NOT = { tag = ROOT }
				OR = {
					1132 = {
						has_merchant = PREV
					}
					1149 = {
						has_merchant = PREV
					}
				}
			}
			export_to_variable = {
				variable_name = ROOT_dev
				value = total_development
				who = ROOT
			}
			export_to_variable = {
				variable_name = PREV_dev
				value = total_development
				who = PREV
			}
			change_variable = {
				which = ROOT_dev
				which = PREV_dev
			}
			while = {
				limit = {
					check_variable = {
						which = ROOT_dev
						value = 1
					}
				}
				subtract_variable = {
					which = ROOT_dev
					value = 1
				}
				add_treasury = 1
				add_manpower = 0.025
			}
			set_variable = {
				which = ROOT_dev
				value = 0
			}
			set_variable = {
				which = PREV_dev
				value = 0
			}
		}
	}
	if = {
		limit = {
			has_global_flag = YEM_relationship
			tag = event_target:YEM_target
		}
		event_target:YEM_beneficiary = {
			add_dip_power = 50
			add_mil_power = 50
		}
	}
	
	if = {
		limit = {
			has_country_modifier = MSY_the_end_is_nigh
			FROM = { 
				NOT = { religion = ROOT }
			}
		}
		add_disaster_progress = {
			disaster = ME_the_end_of_times
			value = -2.5
		}
	}
	
	if = {
		limit = {
			has_reform = timurid_prince
			any_country = {
				dynasty = ROOT
				is_subject_of = ROOT
				has_opinion_modifier = {
					who = ROOT
					modifier = TIM_sibling_rivalry
				}
			}
		}
		every_known_country = {
			limit = {
				dynasty = ROOT
				is_subject_of = ROOT
				has_opinion_modifier = {
					who = ROOT
					modifier = TIM_sibling_rivalry
				}
			}
			remove_opinion = {
				who = ROOT
				modifier = TIM_sibling_rivalry
			}
			reverse_remove_opinion = {
				who = ROOT
				modifier = TIM_sibling_rivalry
			}
		}
	}
	
	if = {
		limit = {
			tag = TIM
			has_country_flag = me_tim_flight_to_india
			any_owned_province = {
				superregion = india_superregion
			}
		}
		country_event = { id = ME_Timurid_Succession_Crisis_Events.10 }
	}
	
	if = {
		limit = {
			tag = AFG
			is_subject = no
			NOT = { has_country_flag = me_afg_babur_arrival }
		}
		set_country_flag = me_afg_babur_arrival
		country_event = { id = ME_Timurid_Princes_Event.26 days = 32 }
	}
	
	if = {
		limit = {
			has_country_flag = me_tim_win_wars
		}
		change_variable = {
			which = METimWonWars
			value = 1
		}
	}

	if = {
		limit = {
			NOT = {
				exists = TIM
			}
			any_province = {
				has_province_flag = me_tim_wasteland
			}
		}
		every_province = {
			limit = {
				has_province_flag = me_tim_wasteland
			}
			clr_province_flag = me_tim_wasteland
		}
	}
}

on_force_conversion = {
	#if = {	#Commented out for now because Catholicism has received a lot of buffs already.
	#	limit = {
	#		FROM = { religion = catholic }
	#	}
	#	if = {
	#		limit = { ROOT = { government_rank = 3 } }
	#		FROM = { add_papal_influence = 20 }
	#	}
	#	else_if = {
	#		limit = { ROOT = { government_rank = 2 } }
	#		FROM = { add_papal_influence = 10 }
	#	}
	#	else = {
	#		FROM = { add_papal_influence = 5 }
	#	}
	#}
	
	if = {
		limit = {
			FROM = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		FROM = {
			add_disaster_progress = {
				disaster = ME_the_end_of_times
				value = -2.5
			}
		}
	}
	
	if = {
		limit = {
			technology_group = western
			FROM = {
				has_country_flag = ARB_islamization_of_europe_cb
			}
		}
		add_power_projection = {
			type = ARB_islamization_of_europe
			amount = 5
		}
	}
	
	if = {
		limit = {
			FROM = { has_country_flag = RUM_conversion }
		}
		FROM = { add_adm_power = 50 }
	}
}

on_startup = {
	# BAG = {
		# set_heir_flag = QAR_fulad
	# }
	
	if = {
		limit = {
			current_age = age_of_discovery
		}
		LXA = {
			if = {
				limit = {
					NOT = { has_country_flag = lxa_loyalty_flag }
				}
				add_estate_loyalty = {
					estate = estate_church
					loyalty = -10
				}
				set_country_flag = lxa_loyalty_flag
			}
		}
	}
	emperor = {
		save_global_event_target_as = Emperor
	}
	if = {
		limit = {
			is_emperor_of_china = yes
		}
		save_global_event_target_as = EmperorOfChina
	}
	events = {
		muslim_school_events.20 #Pick School
	#flavor_fra.15000 #Make the French Revolution happen if starting in 1789
		ME_Qara_Qoyunlu_Events.10
		missions_expanded_events.5
	}
	if = {
		limit = {
			has_dlc = "Cradle of Civilization"
			has_country_modifier = tur_janissary
		}
		remove_country_modifier = tur_janissary
	}
	initialize_schools_effect = yes #This is only used here but is used for readability of on_action file.

	if = {
		limit = {
			NOT = { has_country_flag = new_flavour_bav_13_has_been_triggered }
			OR = {
				tag = UBV
				tag = LBV
				tag = ING
			}
		}
		set_country_flag = new_flavour_bav_13_has_been_triggered
		country_event = { id = new_flavour_bav.13 days = 90 } #better not to allow almost instant DOWs
	}
	if = {
		limit = {
			tag = FRA
			started_in = 1789.7.14
			NOT = { is_year = 1790 }
			NOT = { has_disaster = french_revolution }
		}
		add_disaster_progress = {
			value = 100
			disaster = french_revolution
		}
	}
	if = {
		limit = {
			exists = SUK
		}
		SUK = {
			set_ruler_flag = suk_monarch_flag
		}
		AYU = {
			set_country_flag = ayu_monarch_flag
		}
	}
	
	361 = { 
		province_event = { id = ME_Abbasid_Events.1 }
	}
}

on_add_pasha = {
	hidden_effect = {
		owner = {
			save_event_target_as = province_owner
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_empowerment
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_modifier
				duration = -1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_seljuk_flag
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_seljuk_modifier
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_roman_flag
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_roman_modifier
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = RUM_pasha_caliphate_modifier
			}
		}
		area = {
			limit = {
				owned_by = event_target:province_owner
			}
			add_province_modifier = {
				name = RUM_pasha_caliphate_flag 
				duration = -1
			}
		}
	}
	else = { }
}

# THIS = One province in the state
on_remove_pasha = {
	hidden_effect = {
		owner = {
			save_event_target_as = province_owner
		}
	}

	area = {
		limit = { owned_by = event_target:province_owner }
		add_or_extend_province_modifier_effect = { MODIFIER = pasha_removed_modifier DURATION = 3650 }
		remove_province_modifier = RUM_pasha_modifier
		remove_province_modifier = RUM_pasha_seljuk_modifier
		remove_province_modifier = RUM_pasha_roman_modifier
		remove_province_modifier = RUM_pasha_caliphate_modifier
	}
}

on_janissaries_raised = {
	owner = {
		if = {
			limit = {
				has_country_flag = RUM_cost_of_janissaries_decreased
			}
			add_mil_power = 6
		}
	}
}

#on_four_year_pulse_4 = {
#	random_events = {
#		# Board of Personnel chain
#		100 = ME_Manchu_Events.17
#		100 = ME_Manchu_Events.18
#		100 = ME_Manchu_Events.19
#
#		# Bourd of Revenue chain
#		100 = ME_Manchu_Events.21
#		100 = ME_Manchu_Events.22
#		100 = ME_Manchu_Events.23
#	}
#}

# country
# root = winning country, from = location
on_siege_won_country = {
	if = {
		limit = {
			from = { owned_by = SAX }
			OR = {
				is_in_war = {
					defenders = root
					defenders = THU
					defenders = emperor
					attackers = SAX
				}
				is_in_war = {
					attackers = root
					attackers = THU
					attackers = emperor
					defenders = SAX
				}
			}
			THU = {
				dynasty = "von Wettin"
				is_elector = no
				is_emperor = no
				alliance_with = emperor
			}
			SAX = {
				is_elector = yes
				all_owned_province = {
					NOT = { controlled_by = SAX }
					OR = {
						controlled_by = THU
						controller = {
							OR = {
								is_in_war = {
									defenders = this
									defenders = THU
									defenders = emperor
									attackers = SAX
								}
								is_in_war = {
									attackers = this
									attackers = THU
									attackers = emperor
									defenders = SAX
								}
							}
						}
					}
				}
			}
		}
		THU = { country_event = { id = flavor_sax.10 } } # Ask Emperor for Saxon Electorate
	}
	if = {
		limit = {
			ROOT = {
				religion = jewish
				has_church_aspect = judaism_remember_passover_aspect
			}
			FROM = {
				owner = {
					war_with = ROOT
				}
				fort_level = 1
			}
		}
		ROOT = {
			add_church_power = 5
		}
	}
	grant_manpower_from_capital_slave_raid = yes
	
	if = {
		limit = {
			FROM = {
				OR = {
					region = malaya_region
					region = indonesia_region
				}
				controller = {
					has_country_flag = me_mug_expedition_start
				}
			}
		}
		FROM = {
			save_global_event_target_as = expedition_spawn
		}
		country_event = { id = ME_Mughal_Events.25 }
		clr_country_flag = me_mug_expedition_start
	}
	
	#Hindu Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_hindustan_focus
			FROM = {
				province_id = 522
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_hindu_subah
		add_ruler_modifier = {
			name = me_mug_hindu_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_hindustan_focus
			FROM = {
				province_id = 522
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_hindu_subah_negative
		add_ruler_modifier = {
			name = me_mug_hindu_subah
			duration = -1
		}
	}
	
	#Bengal Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_bengal_focus
			FROM = {
				province_id = 563
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_bengal_subah
		add_ruler_modifier = {
			name = me_mug_bengal_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_bengal_focus
			FROM = {
				province_id = 563
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_bengal_subah_negative
		add_ruler_modifier = {
			name = me_mug_bengal_subah
			duration = -1
		}
	}
	
	#Rajput Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_rajput_focus
			FROM = {
				province_id = 2087
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_rajput_subah
		add_ruler_modifier = {
			name = me_mug_rajput_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_rajput_focus
			FROM = {
				province_id = 2087
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_rajput_subah_negative
		add_ruler_modifier = {
			name = me_mug_rajput_subah
			duration = -1
		}
	}
	
	#Gujarat Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_gujarat_focus
			FROM = {
				province_id = 2054
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_gujarat_subah
		add_ruler_modifier = {
			name = me_mug_gujarat_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_gujarat_focus
			FROM = {
				province_id = 2054
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_gujarat_subah_negative
		add_ruler_modifier = {
			name = me_mug_gujarat_subah
			duration = -1
		}
	}
	
	#Malwa Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 526
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_malwa_subah_bonus
		add_ruler_modifier = {
			name = me_mug_malwa_subah_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 526
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_malwa_subah_negative
		add_ruler_modifier = {
			name = me_mug_malwa_subah_bonus
			duration = -1
		}
	}
	
	#Deccan Subah
	if = {
		limit = {
			has_ruler_flag = me_mug_deccan_focus
			FROM = {
				province_id = 541
				NOT = { owned_by = ROOT }
			}
		}
		remove_country_modifier = me_mug_deccan_subah_bonus
		add_ruler_modifier = {
			name = me_mug_deccan_subah_bonus_negative
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_ruler_flag = me_mug_malwa_focus
			FROM = {
				province_id = 541
				owned_by = ROOT
			}
		}
		remove_country_modifier = me_mug_deccan_subah_bonus_negative
		add_ruler_modifier = {
			name = me_mug_deccan_subah_bonus
			duration = -1
		}
	}

	if = {
		limit = {
			from = { fort_level = 1 }
		}
		change_variable = {
			which = num_of_sieges_won
			value = 1
		}
	}
	
	events = {
		tyw_events.14 # Fall of Prague in Religious War
		flavor_oir.5 # Oirats capture Beijing
		flavor_lna.1 # Emerald Buddha
		flavor_son.14 # Djenne surrenders to Songhai Trigger
		flavor_teu.25 # Payback for the Hussite Wars
	}
	random_events = {
		10 = army_professionalism_events.1 #City Sacked
		100 = 0
	}
}

on_siege_won_province = {
	events = {
		synthetic_dawn.4
	}
	if = {
		limit = {
			from = {
				tag = REB
				is_rebel_type = revolutionary_rebels
			}
			owner = {
				any_owned_province = {
					region = root
					has_revolution_in_province = yes
				}
				NOT = { has_disaster = french_revolution }
				NOT = { has_disaster = revolution }
				NOT = { has_spawned_rebels = revolutionary_rebels }
			}
		}
		owner = { country_event = { id = center_of_revolution.1600 } }
	}
	if = {
		limit = {
			superregion = china_superregion
			controller = {
				has_government_attribute = has_unify_china_cb
				OR = {
					is_in_war = {
						attacker_leader = this
						casus_belli = cb_chinese_unification
					}
					is_in_war = {
						defender_leader = this
						casus_belli = cb_chinese_unification
					}
				}
				NOT = { is_core = ROOT }
			}
		}
		controller = { 
			add_core = ROOT
			remove_claim = ROOT
		}
	}
	
	if = {
		limit = {
			culture = andalucian
			controller = {
				capital_scope = {
					region = maghreb_region
				}
				is_in_war = {
					casus_belli = cb_oran_fatwa
				}
			}
			from = {
				religion_group = christian
			}
		}
		controller = {
			ROOT = { save_event_target_as = Tunis_the_province }
			country_event = { id = ME_Tunis_Events.13 }
		}
	}
}

on_capital_moved = {
	if = {
		limit = {
			has_country_modifier = me_mug_capital_of_agra
			524 = {
				has_province_modifier = me_mug_capital_city
			}
			NOT = { capital = 524 }
		}
		remove_country_modifier = me_mug_capital_of_agra
		524 = {
			remove_province_modifier = me_mug_capital_city
		}
	}
	else_if = {
		limit = {
			has_country_flag = me_mug_agra_capital_bonuses
			NOT = { has_country_modifier = me_mug_capital_of_agra }
			524 = {
				NOT = { has_province_modifier = me_mug_capital_city }
			}
			capital = 524
		}
		add_country_modifier = {
			name = me_mug_capital_of_agra
			duration = -1
		}
		524 = {
			add_province_modifier = {
				name = me_mug_capital_city
				duration = -1
			}
		}
	}
}

on_four_year_pulse_3 = { #for our nobles
	random_events = {
		1500 = 0
		100 = me_austria_nobles.2
		100 = me_austria_nobles.3
	}
}

# province
on_province_religion_converted = {
	on_province_religion_converted_estate_privileges_effect = yes
	if = {
		limit = {
			owner = {
				has_country_modifier = son_fetishism_as_secondary_religion
			}
			religion = shamanism
			NOT = { has_province_modifier = son_fetishism_as_secondary_religion_province }
		}
		add_province_modifier = {
			name = son_fetishism_as_secondary_religion_province
			duration = -1
			desc = son_fetishism_as_secondary_religion_province_desc
		}
	}
	else_if = {
		limit = {
			OR = {
				owner = {
					NOT = { has_country_modifier = son_fetishism_as_secondary_religion }
				}
				NOT = { religion = shamanism }
			}
			has_province_modifier = son_fetishism_as_secondary_religion_province
		}
		remove_province_modifier = son_fetishism_as_secondary_religion_province
	}
	judaism_on_province_change_religion_or_change_owner_effect = yes
	
	if = {
		limit = {
			owner = {
				has_country_modifier = me_hab_imperial_court_chaplain
			}
		}
		emperor = {
			add_imperial_influence = 1
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = ME_muslim_enforced_religion
			}
			# religion_group = owner 
			# NOT = { religion = owner }
		}
		export_to_variable = {
			which = ME_temp_religion_enforced
			value = trigger_value:development
		}
		while = {
			limit = {
				check_variable = {
					which = ME_temp_religion_enforced
					value = 1
				}
			}
			owner = {
				add_piety = 0.02
			}
			change_variable = {
				which = ME_temp_religion_enforced
				value = -1
			}
		}
	}
	
	if = {
		limit = {
			owner = {
				has_country_modifier = MSY_the_end_is_nigh
			}
		}
		export_to_variable = {
			which = MSY_temp
			value = trigger_value:development
		}
		while = {
			limit = {
				check_variable = {
					which = MSY_temp
					value = 1
				}
			}
			owner = {
				add_disaster_progress = {
					disaster = ME_the_end_of_times
					value = -0.2
				}
			}
			change_variable = {
				which = MSY_temp
				value = -1
			}
		}
	}
	
	# if = {
		# limit = {
			# owner = {
				# has_country_flag = RUM_piety_from_conversion
			# }
		# }
		# export_to_variable = {
			# which = MSY_temp
			# value = trigger_value:development
		# }
		# while = {
			# limit = {
				# check_variable = {
					# which = MSY_temp
					# value = 1
				# }
			# }
			# owner = {
				# add_positive_or_negative_piety = { amount = 0.2 }
			# }
			# change_variable = {
				# which = MSY_temp
				# value = -1
			# }
		# }
	# }

	if = {
		limit = {
			owner = {
				has_country_flag = me_tim_reduced_conversion_on_razing
			}
		}
		remove_province_modifier = religious_zeal_at_conv
		add_province_modifier = {
			name = me_tim_harsh_conversions
			duration = 7300
		}
	}
}

# ROOT = Overlord, FROM = Minor
on_dependency_lost = {
	if = { 
        limit = { 
            AND = {
                ROOT = { has_country_modifier = me_hab_imperial_march }
                FROM = { has_country_modifier = me_bra_new_march }
            }
        }
        FROM = { remove_country_modifier = me_bra_new_march }
        ROOT = { remove_country_modifier = me_hab_imperial_march }
    }
}

on_center_of_trade_upgrade = {
	if = {
		limit = { owner = { has_country_flag = enable_upgrading_centers_of_trade_dev } }
		add_base_production = 1 
	}
	if = { 
		limit = { 
			owner = { has_country_flag = tur_built_sari_markets } 
		}
		add_base_production = 1
	}

	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_cot_bonus
			}
		}
		add_base_production = 2
	}
}

on_center_of_trade_downgrade = {
	if = {
		limit = { owner = { has_country_flag = enable_upgrading_centers_of_trade_dev } }
		add_base_production = -1 
	}
	if = { 
		limit = { 
			owner = { has_country_flag = tur_built_sari_markets } 
		}
		add_base_production = -1
	}
	
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_cot_bonus
			}
		}
		add_base_production = -2
	}
}

on_parliament_debate_succeeded = {
	increase_issue_passed_counter = yes
	if = { 
		limit = { 
			has_country_flag = issue_grants_25_random_pp_flag
		}
		random_list = { 
			33 = { add_adm_power = 25 } 
			34 = { add_dip_power = 25 } 
			33 = { add_mil_power = 25 } 
		}
	}
}

on_extend_regency = {
	if = { 
		limit = { has_country_flag = tur_reign_of_women_era_flag } 
		add_legitimacy = 10 
		random_list = { 
			30 = { 
				change_adm = 1 
				add_adm_power = 50 
			} 
			40 = { 
				change_dip = 1 
				add_dip_power = 50 
			}
			30 = { 
				change_mil = 1 
				add_mil_power = 50 
			}
		}
	}
}

# province
# FROM = old owner
on_province_owner_change = {
	events = {
		japan.1
	}
	on_province_owner_change_government_effect = yes

	if = {
		limit = {
			owned_by = SRU
			exists = ARA
		}
		ARA = {
			set_country_flag = ARA_defeat_saruhan
		}
	}
	if = {
		limit = {
			NOT = { owner = { religion_group = muslim } }
			has_province_modifier = sufi_shrine
		}
		remove_province_modifier = sufi_shrine
	}
	on_province_owner_change_estate_privileges_effect = yes
	judaism_on_province_change_religion_or_change_owner_effect = yes
	imperial_modifiers_on_province_change_culture_or_change_owner_effect = yes
	
	if = {
		limit = {
			region = indo_china_region
			has_building = farm_estate
			trade_goods = grain
			owner = {
				has_mission = mnd_khm_irrigation 
				NOT = {
					OR = {
						has_estate = estate_vaisyas
						has_estate = estate_burghers
					}
				}
			}
		}
		add_province_modifier = {
			name = grain_production_improved
			duration = 7300
		}
	}

	if = {
		limit = {
			trade_goods = gold
			NOT = { has_province_modifier = estate_burghers_control_over_gold_mine }
			owner = {
				has_estate_privilege = estate_burghers_control_over_the_mint
			}
		}
		add_province_modifier = {
			name = estate_burghers_control_over_gold_mine
			duration = -1
		}
	}
	
	if = {
		limit = {
			province_id = 379
			owner = {
				NOT = { religion = jewish }
			}
		}
		remove_country_modifier = third_temple_country_modifier
	}
	if = {
		limit = {
			owner = {
				has_country_modifier = son_fetishism_as_secondary_religion
			}
			religion = shamanism
			NOT = { has_province_modifier = son_fetishism_as_secondary_religion_province }
		}
		add_province_modifier = {
			name = son_fetishism_as_secondary_religion_province
			duration = -1
			desc = son_fetishism_as_secondary_religion_province_desc
		}
	}
	else_if = {
		limit = {
			OR = {
				owner = {
					NOT = { has_country_modifier = son_fetishism_as_secondary_religion }
				}
				NOT = { religion = shamanism }
			}
			has_province_modifier = son_fetishism_as_secondary_religion_province
		}
		remove_province_modifier = son_fetishism_as_secondary_religion_province
	}
	if = {
		limit = {
			owner = {
				has_country_modifier = me_mug_shipbuilding_industry
			}
			trade_goods = naval_supplies
		}
		add_province_modifier = {
			name = me_mug_shipbuilding_province
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			has_province_modifier = me_mug_shipbuilding_province
			owner = {
				NOT = {
					has_country_modifier = me_mug_shipbuilding_industry
				}
			}
		}
		remove_province_modifier = me_mug_shipbuilding_province
	}
	
	if = {
		limit = {
			owner = {
				has_estate_privilege = ME_estate_burghers_steppe_development
			}
			has_climate = steppe
		}
		add_province_modifier = {
			name = estate_burghers_steppe_development_rt
			duration = -1
			hidden = yes
		}
	}
	else_if = {
		limit = {
			has_province_modifier = estate_burghers_steppe_development
			owner = {
				NOT = {
					has_estate_privilege = ME_estate_burghers_steppe_development
				}
			}
		}
		remove_province_modifier = estate_burghers_steppe_development
	}
}

#ROOT = province that was centralized in
on_centralized_state = {
	if = {
		limit = {
			owner = { has_government_attribute = centralize_state_no_reform_cost }
		}
		owner = {
			add_adm_power = 50
			change_government_reform_progress = 50
		}
	}
	if = {
		limit = {
			owner = { has_government_attribute = centralize_state_development }
		}
		area = {
			limit = {
				owned_by = ROOT
			}
			random_list = {
				1 = { add_base_tax = 1 }
				1 = { add_base_production = 1 }
				1 = { add_base_manpower = 1 }
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_country_flag = me_mug_centralize_state_discount
			}
		}
		owner = {
			add_adm_power = 25
			change_government_reform_progress = 25
		}
	}
}

on_loan_repaid = {
	on_loan_repaid_estate_privileges_effect = yes
	if = {
		limit = {
			has_country_flag = MAM_repaying_loans_gives_lower_inflation
		}
		add_inflation = -0.1
	}
}

#ROOT = province
on_adm_exploited = {
	ME_on_exploit_development = yes
	if = {
		limit = { owner = { has_government_attribute = may_not_reduce_tax_on_exploitation } }
		random = {
			chance = 50
			add_base_tax = 1
		}
	}
	if = {
		limit = { owner = { has_government_attribute = may_not_reduce_tax_on_own_exploitation culture_group = ROOT } }
		random = {
			chance = 25
			add_base_tax = 1
		}
	}
	if = {
		limit = { owner = { has_government_attribute = may_not_reduce_tax_on_foreign_exploitation NOT = { culture_group = ROOT } } }
		random = {
			chance = 50
			add_base_tax = 1
		}
	}
}
on_dip_exploited = {
	ME_on_exploit_development = yes
}
on_mil_exploited = {
	ME_on_exploit_development = yes
}

on_reform_enacted = {
	if = {
		limit = {
			mission_completed = ME_tim_military_administration
		}
		add_army_professionalism = 0.05
		add_army_tradition = 10
	}
}